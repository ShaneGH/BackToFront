(function(b){var c,d,e,g;var j=/^[\w\d_]+(,([\w\d_]+))*$/;var i=/^[\s\t\r\n]*\{.*\}[\s\t\r\n]*$/;var k=/[\s\t\r\n]/g;var a=function(l,m){return f(l).Union(m).Result};b.Linq=function(l){this.Result=f.utils.transformToArray(l)};b.linq=function(l){return new b.Linq(l?l:[])};var f=b.linq;f.utils={convertLambda:function(l){if(!l||l.constructor===Function){return l}else{if(l.constructor!==String){throw"Invalid linq function"}else{if(l.indexOf("=>")===-1){throw'"=>" expression not found'}}}var n=l.substring(l.indexOf("=>")+2);var m=l.substring(0,l.indexOf("=>")).replace(k,"");if(m.indexOf("(")===0){m=m.substring(1);if(m.indexOf(")")===m.length-1){m=m.substring(0,m.length-1)}else{throw"Invalid left hand side"}}if(m.length<1||!j.test(m)){throw"Invalid left hand side"}else{if(n.length<1){throw"Invalid right hand side"}}if(i.test(n)){return new Function(m,n)}else{return new Function(m,"return "+n+";")}},transformToArray:function(l){if(l.constructor===Array){return l}else{if(l.constructor===b.Linq){return l.Result}else{if(l.constructor===NodeList){return l}else{throw"Input must be array or Linq object"}}}},transformToLinq:function(l){if(l.constructor===b.Linq){return l}else{if(l.constructor===Array){return f(l)}else{throw"Input must be array or Linq object"}}}};f.fn=b.Linq.prototype;f.fn.Select=function(o){o=f.utils.convertLambda(o);var n=f();for(var l=0,m=this.Result.length;l<m;l++){n.Result[l]=o(this.Result[l])}return n};var h=function(m,n){n=f.utils.convertLambda(n);var l=function(p){return p!=null&&p.constructor===Number};var o=(n?m.Select(n):m).Where(l).Result;if(o.length===0){throw"Sequence contains no elements."}return o};f.fn.Max=function(l){return Math.max.apply(Math,h(this,l))};f.fn.Min=function(l){return Math.min.apply(Math,h(this,l))};f.fn.Aggregate=function(l){if(l===undefined){l=a}else{l=f.utils.convertLambda(l)}var o=f();for(var m=0,n=this.Result.length;m<n;m++){o.Result=l(o.Result,this.Result[m])}return o};f.fn.Union=function(l){l=f.utils.transformToArray(l);var p=f();var m;for(m=0,c=this.Result.length;m<c;m++){p.Result[m]=this.Result[m]}for(var n=0,o=l.length;n<o;n++){if(!p.Contains(l[n])){p.Result[m+n]=l[n]}else{m--}}return p};f.fn.Contains=function(l){for(var m=0,n=this.Result.length;m<n;m++){if(this.Result[m]===l){return true}}return false};f.fn.Any=function(n){if(!n){return this.Result.length>0}n=f.utils.convertLambda(n);for(var l=0,m=this.Result.length;l<m;l++){if(n(this.Result[l])){return true}}return false};f.fn.Where=function(p){p=f.utils.convertLambda(p);var o=0;var n=f();for(var l=0,m=this.Result.length;l<m;l++){if(p(this.Result[l])){n.Result[l-o]=this.Result[l]}else{o++}}return n};f.fn.First=function(n){if(!n){return this.Result[0]}else{n=f.utils.convertLambda(n);for(var l=0,m=this.Result.length;l<m;l++){if(n(this.Result[l])){return this.Result[l]}}}return null};f.fn.Last=function(m){if(!m){return this.Result[this.Result.length-1]}else{m=f.utils.convertLambda(m);for(var l=this.Result.length-1;l>=0;l--){if(m(this.Result[l])){return this.Result[l]}}}return null};f.fn.GroupBy=function(p){p=f.utils.convertLambda(p);var o=f();var n=null;var q=null;for(var l=0,m=this.Result.length;l<m;l++){n=p(this.Result[l]);q=o.Where(function(r){return r.key===n});if(q.Any()){q.Result[0].values.push(this.Result[l])}else{o.Result.push({key:n,values:[this.Result[l]]})}}return o};f.fn.OrderBy=function(q){q=f.utils.convertLambda(q);var l=new Object();var o=f();var u=[];var t=[];var s=null;for(var m=0,n=this.Result.length;m<n;m++){var p=q?q(this.Result[m]):this.Result[m];u[m]={key:m,value:p};t[m]={key:m,value:this.Result[m]};if(p&&s==null){s=typeof p==="number"?l:p.constructor}else{if(p&&s!==(typeof p==="number"?l:p.constructor)){throw"Invalid comparison type"}}}var r=function(v,w){if(v.value<w.value){return -1}else{if(v.value>w.value){return 1}else{return 0}}};u.sort(r);for(var m=0,n=u.length;m<n;m++){o.Result[m]=f(t).First(function(v){return v.key===u[m].key}).value}return o};f.fn.OrderByDecending=function(m){var l=this.OrderBy(f.utils.convertLambda(m));l.Result.reverse();return l};f.fn.Skip=function(o){var n=f();for(var l=o,m=this.Result.length;l<m;l++){n.Result[l-o]=this.Result[l]}return n};f.fn.Take=function(o){var n=f();var m=o<this.Result.length?o:this.Result.length;for(var l=0;l<m;l++){n.Result[l]=this.Result[l]}return n};f.fn.Distinct=function(){var o=0;var n=f();for(var l=0,m=this.Result.length;l<m;l++){if(!n.Contains(this.Result[l])){n.Result[l-o]=this.Result[l]}else{o++}}return n};f.fn.Each=function(n){n=f.utils.convertLambda(n);for(var l=0,m=this.Result.length;l<m;l++){n(this.Result[l],l)}return this};f.fn.ReverseEach=function(m){m=f.utils.convertLambda(m);for(var l=this.Result.length-1;l>=0;l--){m(this.Result[l],l)}return this}})(window);var WebExpressions;(function(b){(function(e){(function(f){f._map=[];f.Binary=1;f.Constant=2;f.Member=3;f.MethodCall=4;f.Parameter=5;f.Unary=6;f.Default=7;f.Block=8;f.Conditional=9;f.Invocation=10;f.New=11})(e.ExpressionWrapperType||(e.ExpressionWrapperType={}));var d=e.ExpressionWrapperType;(function(f){f._map=[];f.Add=0;f.AddChecked=1;f.And=2;f.AndAlso=3;f.ArrayLength=4;f.ArrayIndex=5;f.Call=6;f.Coalesce=7;f.Conditional=8;f.Constant=9;f.Convert=10;f.ConvertChecked=11;f.Divide=12;f.Equal=13;f.ExclusiveOr=14;f.GreaterThan=15;f.GreaterThanOrEqual=16;f.Invoke=17;f.Lambda=18;f.LeftShift=19;f.LessThan=20;f.LessThanOrEqual=21;f.ListInit=22;f.MemberAccess=23;f.MemberInit=24;f.Modulo=25;f.Multiply=26;f.MultiplyChecked=27;f.Negate=28;f.UnaryPlus=29;f.NegateChecked=30;f.New=31;f.NewArrayInit=32;f.NewArrayBounds=33;f.Not=34;f.NotEqual=35;f.Or=36;f.OrElse=37;f.Parameter=38;f.Power=39;f.Quote=40;f.RightShift=41;f.Subtract=42;f.SubtractChecked=43;f.TypeAs=44;f.TypeIs=45;f.Assign=46;f.Block=47;f.DebugInfo=48;f.Decrement=49;f.Dynamic=50;f.Default=51;f.Extension=52;f.Goto=53;f.Increment=54;f.Index=55;f.Label=56;f.RuntimeVariables=57;f.Loop=58;f.Switch=59;f.Throw=60;f.Try=61;f.Unbox=62;f.AddAssign=63;f.AndAssign=64;f.DivideAssign=65;f.ExclusiveOrAssign=66;f.LeftShiftAssign=67;f.ModuloAssign=68;f.MultiplyAssign=69;f.OrAssign=70;f.PowerAssign=71;f.RightShiftAssign=72;f.SubtractAssign=73;f.AddAssignChecked=74;f.MultiplyAssignChecked=75;f.SubtractAssignChecked=76;f.PreIncrementAssign=77;f.PreDecrementAssign=78;f.PostIncrementAssign=79;f.PostDecrementAssign=80;f.TypeEqual=81;f.OnesComplement=82;f.IsTrue=83;f.IsFalse=84})(e.ExpressionType||(e.ExpressionType={}));var c=e.ExpressionType})(b.Meta||(b.Meta={}));var a=b.Meta})(WebExpressions||(WebExpressions={}));var WebExpressions;(function(b){var a=(function(){function d(e){b.Sanitizer.Require(e,{inputName:"NodeType",inputConstructor:Number},{inputName:"ExpressionType",inputConstructor:Number});this.NodeType=e.NodeType;this.ExpressionType=e.ExpressionType}d.prototype.Compile=function(){if(!this._Compiled){this._Compiled=this._Compile()}return this._Compiled};d.prototype._Compile=function(){throw"Invalid operation"};d.prototype.GetAffectedProperties=function(){return[]};d.ExpressionConstructorDictionary=(function(){var e={};e[b.Meta.ExpressionWrapperType.Binary]=function(f){return new b.BinaryExpression(f)};e[b.Meta.ExpressionWrapperType.Block]=function(f){return new b.BlockExpression(f)};e[b.Meta.ExpressionWrapperType.Conditional]=function(f){return new b.ConditionalExpression(f)};e[b.Meta.ExpressionWrapperType.Constant]=function(f){return new b.ConstantExpression(f)};e[b.Meta.ExpressionWrapperType.Default]=function(f){return new b.DefaultExpression(f)};e[b.Meta.ExpressionWrapperType.Member]=function(f){return new b.MemberExpression(f)};e[b.Meta.ExpressionWrapperType.MethodCall]=function(f){return new b.MethodCallExpression(f)};e[b.Meta.ExpressionWrapperType.Parameter]=function(f){return new b.ParameterExpression(f)};e[b.Meta.ExpressionWrapperType.Unary]=function(f){return new b.UnaryExpression(f)};e[b.Meta.ExpressionWrapperType.Invocation]=function(f){return new b.InvocationExpression(f)};e[b.Meta.ExpressionWrapperType.New]=function(f){return new b.NewExpression(f)};return e})();d.CreateExpression=function c(e){if(e.NodeType===b.Meta.ExpressionType.Assign&&e.ExpressionType===b.Meta.ExpressionWrapperType.Binary){return new b.AssignmentExpression(e)}if(d.ExpressionConstructorDictionary[e.ExpressionType]){return d.ExpressionConstructorDictionary[e.ExpressionType](e)}throw"Invalid expression type"};return d})();b.Expression=a})(WebExpressions||(WebExpressions={}));var __extends=this.__extends||function(e,c){function a(){this.constructor=e}a.prototype=c.prototype;e.prototype=new a()};var WebExpressions;(function(b){var a=(function(c){__extends(d,c);function d(e){c.call(this,e);b.Sanitizer.Require(e,{inputName:"Left",inputType:"object"},{inputName:"Right",inputType:"object"});switch(e.Left.ExpressionType){case b.Meta.ExpressionWrapperType.Parameter:this.Left=null;this.LeftProperty=(e.Left).Name;break;case b.Meta.ExpressionWrapperType.Member:this.Left=b.Expression.CreateExpression((e.Left).Expression);this.LeftProperty=(e.Left).MemberName;break;default:throw"The left hand side of an assignment must be a parameter or a member"}this.Right=b.Expression.CreateExpression(e.Right)}d.prototype._Compile=function(){var e=this;var f=this.Left?this.Left.Compile():function(h){return h};var g=this.Right.Compile();return function(h){return f(h)[e.LeftProperty]=g(h)}};return d})(b.Expression);b.AssignmentExpression=a})(WebExpressions||(WebExpressions={}));var __extends=this.__extends||function(e,c){function a(){this.constructor=e}a.prototype=c.prototype;e.prototype=new a()};var WebExpressions;(function(c){var b=c.Meta;var a=(function(d){__extends(e,d);function e(f){d.call(this,f);if(!e.OperatorDictionary[this.NodeType]){throw"##Invalid Operator"}c.Sanitizer.Require(f,{inputName:"Left",inputType:"object"},{inputName:"Right",inputType:"object"});this.Left=c.Expression.CreateExpression(f.Left);this.Right=c.Expression.CreateExpression(f.Right)}e.OperatorDictionary=(function(){var f=[];f[c.Meta.ExpressionType.Add]=function(g,h){return g+h};f[c.Meta.ExpressionType.AndAlso]=function(g,h){return g&&h};f[c.Meta.ExpressionType.Divide]=function(g,h){return g/h};f[c.Meta.ExpressionType.Equal]=function(g,h){return g===h};f[c.Meta.ExpressionType.GreaterThan]=function(g,h){return g>h};f[c.Meta.ExpressionType.GreaterThanOrEqual]=function(g,h){return g>=h};f[c.Meta.ExpressionType.LessThan]=function(g,h){return g<h};f[c.Meta.ExpressionType.LessThanOrEqual]=function(g,h){return g<=h};f[c.Meta.ExpressionType.Multiply]=function(g,h){return g*h};f[c.Meta.ExpressionType.OrElse]=function(g,h){return g||h};f[c.Meta.ExpressionType.Subtract]=function(g,h){return g-h};return f})();e.prototype._Compile=function(){var f=this;var g=this.Left.Compile();var h=this.Right.Compile();return function(i){return e.OperatorDictionary[f.NodeType](g(i),h(i))}};return e})(c.Expression);c.BinaryExpression=a})(WebExpressions||(WebExpressions={}));var __extends=this.__extends||function(e,c){function a(){this.constructor=e}a.prototype=c.prototype;e.prototype=new a()};var WebExpressions;(function(b){var a=(function(c){__extends(d,c);function d(e){c.call(this,e);b.Sanitizer.Require(e,{inputName:"Expressions",inputConstructor:Array});this.Expressions=linq(e.Expressions).Select(function(f){return b.Expression.CreateExpression(f)}).Result}d.prototype._Compile=function(){var e=linq(this.Expressions).Select(function(f){return f.Compile()}).Result;return function(f){return linq(e).Each(function(g){return g(f)})}};return d})(b.Expression);b.BlockExpression=a})(WebExpressions||(WebExpressions={}));var __extends=this.__extends||function(e,c){function a(){this.constructor=e}a.prototype=c.prototype;e.prototype=new a()};var WebExpressions;(function(b){var a=(function(c){__extends(d,c);function d(e){c.call(this,e);b.Sanitizer.Require(e,{inputName:"IfTrue",inputType:"object"},{inputName:"IfFalse",inputType:"object"},{inputName:"Test",inputType:"object"});this.IfTrue=b.Expression.CreateExpression(e.IfTrue);this.IfFalse=b.Expression.CreateExpression(e.IfFalse);this.Test=b.Expression.CreateExpression(e.Test)}d.prototype._Compile=function(){var g=this.Test.Compile();var f=this.IfTrue.Compile();var e=this.IfFalse.Compile();return function(h){return g(h)?f(h):e(h)}};return d})(b.Expression);b.ConditionalExpression=a})(WebExpressions||(WebExpressions={}));var __extends=this.__extends||function(e,c){function a(){this.constructor=e}a.prototype=c.prototype;e.prototype=new a()};var WebExpressions;(function(b){var a=(function(c){__extends(d,c);function d(e){c.call(this,e);this.Value=e.Value}d.prototype._Compile=function(){var e=this;return function(f){return e.Value}};return d})(b.Expression);b.ConstantExpression=a})(WebExpressions||(WebExpressions={}));var __extends=this.__extends||function(e,c){function a(){this.constructor=e}a.prototype=c.prototype;e.prototype=new a()};var WebExpressions;(function(b){var a=(function(c){__extends(d,c);function d(e){c.call(this,e)}d.prototype._Compile=function(){return function(e){return null}};return d})(b.Expression);b.DefaultExpression=a})(WebExpressions||(WebExpressions={}));var __extends=this.__extends||function(e,c){function a(){this.constructor=e}a.prototype=c.prototype;e.prototype=new a()};var WebExpressions;(function(b){var a=(function(c){__extends(d,c);function d(e){c.call(this,e);b.Sanitizer.Require(e,{inputName:"Expression",inputType:"object"},{inputName:"Arguments",inputConstructor:Array});this.Expression=b.Expression.CreateExpression(e.Expression);this.Arguments=linq(e.Arguments).Select(function(f){return b.Expression.CreateExpression(f)}).Result}d.prototype._Compile=function(){var f=this.Expression.Compile();var e=linq(this.Arguments).Select(function(g){return g.Compile()}).Result;return function(g){var h=f(g);var i=linq(e).Select(function(j){return j(g)}).Result;return h.apply(g,i)}};return d})(b.Expression);b.InvocationExpression=a})(WebExpressions||(WebExpressions={}));var __extends=this.__extends||function(e,c){function a(){this.constructor=e}a.prototype=c.prototype;e.prototype=new a()};var WebExpressions;(function(b){var a=(function(c){__extends(d,c);function d(e){c.call(this,e);b.Sanitizer.Require(e,{inputName:"Expression",inputType:"object"},{inputName:"MemberName",inputConstructor:String});this.Expression=b.Expression.CreateExpression(e.Expression);this.MemberName=e.MemberName}d.PropertyRegex=new RegExp("^[a-zA-Z][a-zA-Z0-9]*$");d.prototype._Compile=function(){if(!d.PropertyRegex.test(this.MemberName)){throw"Invalid property name: "+this.MemberName}var f=this.MemberName;var e=this.Expression.Compile();return function(g){return e(g)[f]}};return d})(b.Expression);b.MemberExpression=a})(WebExpressions||(WebExpressions={}));var __extends=this.__extends||function(e,c){function a(){this.constructor=e}a.prototype=c.prototype;e.prototype=new a()};var WebExpressions;(function(b){var a=(function(c){__extends(d,c);function d(e){c.call(this,e);b.Sanitizer.Require(e,{inputName:"Object",inputType:"object"},{inputName:"Arguments",inputConstructor:Array},{inputName:"MethodName",inputConstructor:String},{inputName:"MethodFullName",inputConstructor:String});this.Object=b.Expression.CreateExpression(e.Object);this.Arguments=linq(e.Arguments).Select(function(f){return b.Expression.CreateExpression(f)}).Result;this.MethodName=e.MethodName;this.MethodFullName=e.MethodFullName}d.prototype._Compile=function(){var f=this.MethodName;if(!b.MemberExpression.PropertyRegex.test(f)){throw"Invalid method name: "+f}var g=this.Object.Compile();var e=linq(this.Arguments).Select(function(h){return h.Compile()}).Result;return function(h){var i=g(h);var j=linq(e).Select(function(k){return k(h)}).Result;return i[f].apply(i,j)}};return d})(b.Expression);b.MethodCallExpression=a})(WebExpressions||(WebExpressions={}));var __extends=this.__extends||function(e,c){function a(){this.constructor=e}a.prototype=c.prototype;e.prototype=new a()};var WebExpressions;(function(b){var a=(function(c){__extends(d,c);function d(e){c.call(this,e);b.Sanitizer.Require(e,{inputName:"Arguments",inputConstructor:Array},{inputName:"IsAnonymous",inputConstructor:Boolean},{inputName:"Type",inputConstructor:String});if(e.IsAnonymous){b.Sanitizer.Require(e,{inputName:"Members",inputConstructor:Array});if(e.Members.length!==e.Arguments.length){throw"If members are defined, each must have a corresponding argument"}}this.Arguments=linq(e.Arguments).Select(function(f){return b.Expression.CreateExpression(f)}).Result;this.Members=e.Members;this.Type=e.Type;this.IsAnonymous=e.IsAnonymous}d.prototype._Compile=function(){var e=this;var f=linq(this.Arguments).Select(function(g){return g.Compile()}).Result;return function(g){var h=linq(f).Select(function(i){return i(g)}).Result;if(e.IsAnonymous){return e.ConstructAnonymous(h)}else{if(d.RegisteredTypes[e.Type]){return e.Construct(d.RegisteredTypes[e.Type],h)}else{return{}}}}};d.prototype.ConstructAnonymous=function(h){var g={};for(var e=0,f=this.Members.length;e<f;e++){g[this.Members[e]]=h[e]}return g};d.prototype.Construct=function(f,e){var g=Object.create(f.prototype);var h=f.apply(g,e);return typeof h==="object"?h:g};d.RegisteredTypes={};return d})(b.Expression);b.NewExpression=a})(WebExpressions||(WebExpressions={}));var __extends=this.__extends||function(e,c){function a(){this.constructor=e}a.prototype=c.prototype;e.prototype=new a()};var WebExpressions;(function(b){var a=(function(c){__extends(d,c);function d(e){c.call(this,e);b.Sanitizer.Require(e,{inputName:"Name",inputConstructor:String});this.Name=e.Name}d.prototype._Compile=function(){var e=this;return function(f){return f[e.Name]}};return d})(b.Expression);b.ParameterExpression=a})(WebExpressions||(WebExpressions={}));var WebExpressions;(function(b){b.Initialize=function(c){};var a=(function(){function d(){}d.Require=function c(h){var k=[];for(var e=0;e<(arguments.length-1);e++){k[e]=arguments[e+1]}if(h==null){throw"Item must have a value"}for(var f=0,g=k.length;f<g;f++){var j=k[f];if(j.allowNull&&h[j.inputName]==null){return}if(!j.allowNull&&h[j.inputName]==null){throw"Property "+j.inputName+" cannot be null"}if(j.inputType&&typeof h[j.inputName]!==j.inputType){throw"Property "+j.inputName+" must be of type "+j.inputType}if(j.inputConstructor&&h[j.inputName].constructor!==j.inputConstructor){throw {message:"Property "+j.inputName+" must be of a give type",type:j.inputConstructor}}}};return d})();b.Sanitizer=a})(WebExpressions||(WebExpressions={}));var __extends=this.__extends||function(e,c){function a(){this.constructor=e}a.prototype=c.prototype;e.prototype=new a()};var WebExpressions;(function(b){var a=(function(c){__extends(d,c);function d(e){c.call(this,e);b.Sanitizer.Require(e,{inputName:"Operand",inputType:"object"});this.Operand=b.Expression.CreateExpression(e.Operand)}d.OperatorDictionary=(function(){var e=[];e[b.Meta.ExpressionType.Convert]=function(f){return f};e[b.Meta.ExpressionType.Not]=function(f){return !f};return e})();d.prototype._Compile=function(){var e=this;var f=this.Operand.Compile();return function(g){return d.OperatorDictionary[e.NodeType](f(g))}};return d})(b.Expression);b.UnaryExpression=a})(WebExpressions||(WebExpressions={}));var ex=(function(){function b(){}b.createExpression=function a(c){return WebExpressions.Expression.CreateExpression(c)};return b})();