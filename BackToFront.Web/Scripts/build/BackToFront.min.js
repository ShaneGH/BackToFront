(function(){(function(){(function(g){var h,i,j,l;var o=/^[\w\d_]+(,([\w\d_]+))*$/;var n=/^[\s\t\r\n]*\{.*\}[\s\t\r\n]*$/;var p=/[\s\t\r\n]/g;var f=function(q,r){return k(q).Union(r).Result};g.Linq=function(q){this.Result=k.utils.transformToArray(q)};g.linq=function(q){return new g.Linq(q?q:[])};var k=g.linq;k.utils={convertLambda:function(q){if(!q||q.constructor===Function){return q}else{if(q.constructor!==String){throw"Invalid linq function"}else{if(q.indexOf("=>")===-1){throw'"=>" expression not found'}}}var s=q.substring(q.indexOf("=>")+2);var r=q.substring(0,q.indexOf("=>")).replace(p,"");if(r.indexOf("(")===0){r=r.substring(1);if(r.indexOf(")")===r.length-1){r=r.substring(0,r.length-1)}else{throw"Invalid left hand side"}}if(r.length<1||!o.test(r)){throw"Invalid left hand side"}else{if(s.length<1){throw"Invalid right hand side"}}if(n.test(s)){return new Function(r,s)}else{return new Function(r,"return "+s+";")}},transformToArray:function(q){if(q.constructor===Array){return q}else{if(q.constructor===g.Linq){return q.Result}else{if(q.constructor===NodeList){return q}else{throw"Input must be array or Linq object"}}}},transformToLinq:function(q){if(q.constructor===g.Linq){return q}else{if(q.constructor===Array){return k(q)}else{throw"Input must be array or Linq object"}}}};k.fn=g.Linq.prototype;k.fn.Select=function(t){t=k.utils.convertLambda(t);var s=k();for(var q=0,r=this.Result.length;q<r;q++){s.Result[q]=t(this.Result[q])}return s};var m=function(r,s){s=k.utils.convertLambda(s);var q=function(u){return u!=null&&u.constructor===Number};var t=(s?r.Select(s):r).Where(q).Result;if(t.length===0){throw"Sequence contains no elements."}return t};k.fn.Max=function(q){return Math.max.apply(Math,m(this,q))};k.fn.Min=function(q){return Math.min.apply(Math,m(this,q))};k.fn.Aggregate=function(q){if(q===undefined){q=f}else{q=k.utils.convertLambda(q)}var t=k();for(var r=0,s=this.Result.length;r<s;r++){t.Result=q(t.Result,this.Result[r])}return t};k.fn.Union=function(q){q=k.utils.transformToArray(q);var u=k();var r;for(r=0,h=this.Result.length;r<h;r++){u.Result[r]=this.Result[r]}for(var s=0,t=q.length;s<t;s++){if(!u.Contains(q[s])){u.Result[r+s]=q[s]}else{r--}}return u};k.fn.Contains=function(q){for(var r=0,s=this.Result.length;r<s;r++){if(this.Result[r]===q){return true}}return false};k.fn.Any=function(s){if(!s){return this.Result.length>0}s=k.utils.convertLambda(s);for(var q=0,r=this.Result.length;q<r;q++){if(s(this.Result[q])){return true}}return false};k.fn.Where=function(u){u=k.utils.convertLambda(u);var t=0;var s=k();for(var q=0,r=this.Result.length;q<r;q++){if(u(this.Result[q])){s.Result[q-t]=this.Result[q]}else{t++}}return s};k.fn.First=function(s){if(!s){return this.Result[0]}else{s=k.utils.convertLambda(s);for(var q=0,r=this.Result.length;q<r;q++){if(s(this.Result[q])){return this.Result[q]}}}return null};k.fn.Last=function(r){if(!r){return this.Result[this.Result.length-1]}else{r=k.utils.convertLambda(r);for(var q=this.Result.length-1;q>=0;q--){if(r(this.Result[q])){return this.Result[q]}}}return null};k.fn.GroupBy=function(u){u=k.utils.convertLambda(u);var t=k();var s=null;var v=null;for(var q=0,r=this.Result.length;q<r;q++){s=u(this.Result[q]);v=t.Where(function(w){return w.key===s});if(v.Any()){v.Result[0].values.push(this.Result[q])}else{t.Result.push({key:s,values:[this.Result[q]]})}}return t};k.fn.OrderBy=function(v){v=k.utils.convertLambda(v);var q=new Object();var t=k();var z=[];var y=[];var x=null;for(var r=0,s=this.Result.length;r<s;r++){var u=v?v(this.Result[r]):this.Result[r];z[r]={key:r,value:u};y[r]={key:r,value:this.Result[r]};if(u&&x==null){x=typeof u==="number"?q:u.constructor}else{if(u&&x!==(typeof u==="number"?q:u.constructor)){throw"Invalid comparison type"}}}var w=function(A,B){if(A.value<B.value){return -1}else{if(A.value>B.value){return 1}else{return 0}}};z.sort(w);for(var r=0,s=z.length;r<s;r++){t.Result[r]=k(y).First(function(A){return A.key===z[r].key}).value}return t};k.fn.OrderByDecending=function(r){var q=this.OrderBy(k.utils.convertLambda(r));q.Result.reverse();return q};k.fn.Skip=function(t){var s=k();for(var q=t,r=this.Result.length;q<r;q++){s.Result[q-t]=this.Result[q]}return s};k.fn.Take=function(t){var s=k();var r=t<this.Result.length?t:this.Result.length;for(var q=0;q<r;q++){s.Result[q]=this.Result[q]}return s};k.fn.Distinct=function(){var t=0;var s=k();for(var q=0,r=this.Result.length;q<r;q++){if(!s.Contains(this.Result[q])){s.Result[q-t]=this.Result[q]}else{t++}}return s};k.fn.Each=function(s){s=k.utils.convertLambda(s);for(var q=0,r=this.Result.length;q<r;q++){s(this.Result[q],q)}return this};k.fn.ReverseEach=function(r){r=k.utils.convertLambda(r);for(var q=this.Result.length-1;q>=0;q--){r(this.Result[q],q)}return this}})(window);var e;(function(g){(function(j){var i=(function(){function k(l,m){this.Key=l;this.Value=m}return k})();var h=(function(){function k(){this._InnerDictionary=[]}k.prototype.ContainsKey=function(l){return linq(this._InnerDictionary).Any(function(m){return m.Key===l})};k.prototype.Add=function(l,m){if(this.ContainsKey(l)){throw"Dictionary alredy contains the key "+l}this._InnerDictionary.push(new i(l,m))};k.prototype.AddOrReplace=function(m,n){var l=linq(this._InnerDictionary).First(function(o){return o.Key===m});if(l){l.Value=n}else{this._InnerDictionary.push(new i(m,n))}};k.prototype.Value=function(m){var l=linq(this._InnerDictionary).First(function(n){return n.Key===m});return l?l.Value:null};k.prototype.Remove=function(n){for(var l=0,m=this._InnerDictionary.length;l<m;l++){if(this._InnerDictionary[l].Key===n){this._InnerDictionary.splice(l,1);return true}}return false};k.prototype.Merge=function(l){if(l){for(var m=0,n=l._InnerDictionary.length;m<n;m++){var o=l._InnerDictionary[m];this.Add(o.Key,o.Value)}}return this};return k})();j.Dictionary=h})(g.Utils||(g.Utils={}));var f=g.Utils})(e||(e={}));var e;(function(g){(function(j){(function(k){k[k.Binary=1]="Binary";k[k.Constant=2]="Constant";k[k.Member=3]="Member";k[k.MethodCall=4]="MethodCall";k[k.Parameter=5]="Parameter";k[k.Unary=6]="Unary";k[k.Default=7]="Default";k[k.Block=8]="Block";k[k.Conditional=9]="Conditional";k[k.Invocation=10]="Invocation";k[k.New=11]="New"})(j.ExpressionWrapperType||(j.ExpressionWrapperType={}));var i=j.ExpressionWrapperType;(function(k){k[k.Add=0]="Add";k[k.AddChecked=1]="AddChecked";k[k.And=2]="And";k[k.AndAlso=3]="AndAlso";k[k.ArrayLength=4]="ArrayLength";k[k.ArrayIndex=5]="ArrayIndex";k[k.Call=6]="Call";k[k.Coalesce=7]="Coalesce";k[k.Conditional=8]="Conditional";k[k.Constant=9]="Constant";k[k.Convert=10]="Convert";k[k.ConvertChecked=11]="ConvertChecked";k[k.Divide=12]="Divide";k[k.Equal=13]="Equal";k[k.ExclusiveOr=14]="ExclusiveOr";k[k.GreaterThan=15]="GreaterThan";k[k.GreaterThanOrEqual=16]="GreaterThanOrEqual";k[k.Invoke=17]="Invoke";k[k.Lambda=18]="Lambda";k[k.LeftShift=19]="LeftShift";k[k.LessThan=20]="LessThan";k[k.LessThanOrEqual=21]="LessThanOrEqual";k[k.ListInit=22]="ListInit";k[k.MemberAccess=23]="MemberAccess";k[k.MemberInit=24]="MemberInit";k[k.Modulo=25]="Modulo";k[k.Multiply=26]="Multiply";k[k.MultiplyChecked=27]="MultiplyChecked";k[k.Negate=28]="Negate";k[k.UnaryPlus=29]="UnaryPlus";k[k.NegateChecked=30]="NegateChecked";k[k.New=31]="New";k[k.NewArrayInit=32]="NewArrayInit";k[k.NewArrayBounds=33]="NewArrayBounds";k[k.Not=34]="Not";k[k.NotEqual=35]="NotEqual";k[k.Or=36]="Or";k[k.OrElse=37]="OrElse";k[k.Parameter=38]="Parameter";k[k.Power=39]="Power";k[k.Quote=40]="Quote";k[k.RightShift=41]="RightShift";k[k.Subtract=42]="Subtract";k[k.SubtractChecked=43]="SubtractChecked";k[k.TypeAs=44]="TypeAs";k[k.TypeIs=45]="TypeIs";k[k.Assign=46]="Assign";k[k.Block=47]="Block";k[k.DebugInfo=48]="DebugInfo";k[k.Decrement=49]="Decrement";k[k.Dynamic=50]="Dynamic";k[k.Default=51]="Default";k[k.Extension=52]="Extension";k[k.Goto=53]="Goto";k[k.Increment=54]="Increment";k[k.Index=55]="Index";k[k.Label=56]="Label";k[k.RuntimeVariables=57]="RuntimeVariables";k[k.Loop=58]="Loop";k[k.Switch=59]="Switch";k[k.Throw=60]="Throw";k[k.Try=61]="Try";k[k.Unbox=62]="Unbox";k[k.AddAssign=63]="AddAssign";k[k.AndAssign=64]="AndAssign";k[k.DivideAssign=65]="DivideAssign";k[k.ExclusiveOrAssign=66]="ExclusiveOrAssign";k[k.LeftShiftAssign=67]="LeftShiftAssign";k[k.ModuloAssign=68]="ModuloAssign";k[k.MultiplyAssign=69]="MultiplyAssign";k[k.OrAssign=70]="OrAssign";k[k.PowerAssign=71]="PowerAssign";k[k.RightShiftAssign=72]="RightShiftAssign";k[k.SubtractAssign=73]="SubtractAssign";k[k.AddAssignChecked=74]="AddAssignChecked";k[k.MultiplyAssignChecked=75]="MultiplyAssignChecked";k[k.SubtractAssignChecked=76]="SubtractAssignChecked";k[k.PreIncrementAssign=77]="PreIncrementAssign";k[k.PreDecrementAssign=78]="PreDecrementAssign";k[k.PostIncrementAssign=79]="PostIncrementAssign";k[k.PostDecrementAssign=80]="PostDecrementAssign";k[k.TypeEqual=81]="TypeEqual";k[k.OnesComplement=82]="OnesComplement";k[k.IsTrue=83]="IsTrue";k[k.IsFalse=84]="IsFalse"})(j.ExpressionType||(j.ExpressionType={}));var h=j.ExpressionType})(g.Meta||(g.Meta={}));var f=g.Meta})(e||(e={}));var e;(function(g){var f=(function(){function h(i){g.Sanitizer.Require(i,{inputName:"NodeType",inputConstructor:Number},{inputName:"ExpressionType",inputConstructor:Number});this.NodeType=i.NodeType;this.ExpressionType=i.ExpressionType}h.prototype.Compile=function(){if(!this._Compiled){this._Compiled=this._Compile()}return this._Compiled};h.prototype._Compile=function(){throw"Invalid operation"};h.prototype.GetAffectedProperties=function(){return[]};h.CreateExpression=function(i){if(i.NodeType===g.Meta.ExpressionType.Assign&&i.ExpressionType===g.Meta.ExpressionWrapperType.Binary){return new g.AssignmentExpression(i)}if(h.ExpressionConstructorDictionary[i.ExpressionType]){return h.ExpressionConstructorDictionary[i.ExpressionType](i)}throw"Invalid expression type"};h.ExpressionConstructorDictionary=(function(){var i={};i[g.Meta.ExpressionWrapperType.Binary]=function(j){return new g.BinaryExpression(j)};i[g.Meta.ExpressionWrapperType.Block]=function(j){return new g.BlockExpression(j)};i[g.Meta.ExpressionWrapperType.Conditional]=function(j){return new g.ConditionalExpression(j)};i[g.Meta.ExpressionWrapperType.Constant]=function(j){return new g.ConstantExpression(j)};i[g.Meta.ExpressionWrapperType.Default]=function(j){return new g.DefaultExpression(j)};i[g.Meta.ExpressionWrapperType.Member]=function(j){return new g.MemberExpression(j)};i[g.Meta.ExpressionWrapperType.MethodCall]=function(j){return new g.MethodCallExpression(j)};i[g.Meta.ExpressionWrapperType.Parameter]=function(j){return new g.ParameterExpression(j)};i[g.Meta.ExpressionWrapperType.Unary]=function(j){return new g.UnaryExpression(j)};i[g.Meta.ExpressionWrapperType.Invocation]=function(j){return new g.InvocationExpression(j)};i[g.Meta.ExpressionWrapperType.New]=function(j){return new g.NewExpression(j)};return i})();return h})();g.Expression=f})(e||(e={}));var c=this.__extends||function(h,g){for(var i in g){if(g.hasOwnProperty(i)){h[i]=g[i]}}function f(){this.constructor=h}f.prototype=g.prototype;h.prototype=new f()};var e;(function(g){var f=(function(h){c(i,h);function i(j){h.call(this,j);g.Sanitizer.Require(j,{inputName:"Left",inputType:"object"},{inputName:"Right",inputType:"object"});switch(j.Left.ExpressionType){case g.Meta.ExpressionWrapperType.Parameter:this.Left=null;this.LeftProperty=(j.Left).Name;break;case g.Meta.ExpressionWrapperType.Member:this.Left=g.Expression.CreateExpression((j.Left).Expression);this.LeftProperty=(j.Left).MemberName;break;default:throw"The left hand side of an assignment must be a parameter or a member"}this.Right=g.Expression.CreateExpression(j.Right)}i.prototype._Compile=function(){var j=this;var k=this.Left?this.Left.Compile():function(m){return m};var l=this.Right.Compile();return function(m){return k(m)[j.LeftProperty]=l(m)}};return i})(g.Expression);g.AssignmentExpression=f})(e||(e={}));var c=this.__extends||function(h,g){for(var i in g){if(g.hasOwnProperty(i)){h[i]=g[i]}}function f(){this.constructor=h}f.prototype=g.prototype;h.prototype=new f()};var e;(function(h){var g=h.Meta;var f=(function(i){c(j,i);function j(k){i.call(this,k);if(!j.OperatorDictionary[this.NodeType]){throw"##Invalid Operator"}h.Sanitizer.Require(k,{inputName:"Left",inputType:"object"},{inputName:"Right",inputType:"object"});this.Left=h.Expression.CreateExpression(k.Left);this.Right=h.Expression.CreateExpression(k.Right)}j.prototype._Compile=function(){var k=this;if(!j.OperatorStringDictionary[this.NodeType]){throw"Invalid expression type"}var l=this.Left.Compile();var m=this.Right.Compile();return function(n){return j.OperatorDictionary[k.NodeType](l(n),m(n))}};j.OperatorDictionary=(function(){var k=[];k[h.Meta.ExpressionType.Add]=function(l,m){return l+m};k[h.Meta.ExpressionType.AndAlso]=function(l,m){return l&&m};k[h.Meta.ExpressionType.Divide]=function(l,m){return l/m};k[h.Meta.ExpressionType.Equal]=function(l,m){return l===m};k[h.Meta.ExpressionType.GreaterThan]=function(l,m){return l>m};k[h.Meta.ExpressionType.GreaterThanOrEqual]=function(l,m){return l>=m};k[h.Meta.ExpressionType.LessThan]=function(l,m){return l<m};k[h.Meta.ExpressionType.LessThanOrEqual]=function(l,m){return l<=m};k[h.Meta.ExpressionType.Multiply]=function(l,m){return l*m};k[h.Meta.ExpressionType.NotEqual]=function(l,m){return l!==m};k[h.Meta.ExpressionType.OrElse]=function(l,m){return l||m};k[h.Meta.ExpressionType.Subtract]=function(l,m){return l-m};return k})();j.OperatorStringDictionary=(function(){var k=[];k[h.Meta.ExpressionType.Add]=" + ";k[h.Meta.ExpressionType.AndAlso]=" && ";k[h.Meta.ExpressionType.Divide]=" / ";k[h.Meta.ExpressionType.Equal]=" === ";k[h.Meta.ExpressionType.GreaterThan]=" > ";k[h.Meta.ExpressionType.GreaterThanOrEqual]=" >= ";k[h.Meta.ExpressionType.LessThan]=" < ";k[h.Meta.ExpressionType.LessThanOrEqual]=" <= ";k[h.Meta.ExpressionType.Multiply]=" * ";k[h.Meta.ExpressionType.NotEqual]=" !== ";k[h.Meta.ExpressionType.OrElse]=" || ";k[h.Meta.ExpressionType.Subtract]=" - ";return k})();return j})(h.Expression);h.BinaryExpression=f})(e||(e={}));var c=this.__extends||function(h,g){for(var i in g){if(g.hasOwnProperty(i)){h[i]=g[i]}}function f(){this.constructor=h}f.prototype=g.prototype;h.prototype=new f()};var e;(function(g){var f=(function(h){c(i,h);function i(j){h.call(this,j);g.Sanitizer.Require(j,{inputName:"Expressions",inputConstructor:Array});this.Expressions=linq(j.Expressions).Select(function(k){return g.Expression.CreateExpression(k)}).Result}i.prototype._Compile=function(){var j=linq(this.Expressions).Select(function(k){return k.Compile()}).Result;return function(k){return linq(j).Each(function(l){return l(k)})}};return i})(g.Expression);g.BlockExpression=f})(e||(e={}));var c=this.__extends||function(h,g){for(var i in g){if(g.hasOwnProperty(i)){h[i]=g[i]}}function f(){this.constructor=h}f.prototype=g.prototype;h.prototype=new f()};var e;(function(g){var f=(function(h){c(i,h);function i(j){h.call(this,j);g.Sanitizer.Require(j,{inputName:"IfTrue",inputType:"object"},{inputName:"IfFalse",inputType:"object"},{inputName:"Test",inputType:"object"});this.IfTrue=g.Expression.CreateExpression(j.IfTrue);this.IfFalse=g.Expression.CreateExpression(j.IfFalse);this.Test=g.Expression.CreateExpression(j.Test)}i.prototype._Compile=function(){var l=this.Test.Compile();var k=this.IfTrue.Compile();var j=this.IfFalse.Compile();return function(m){return l(m)?k(m):j(m)}};return i})(g.Expression);g.ConditionalExpression=f})(e||(e={}));var c=this.__extends||function(h,g){for(var i in g){if(g.hasOwnProperty(i)){h[i]=g[i]}}function f(){this.constructor=h}f.prototype=g.prototype;h.prototype=new f()};var e;(function(g){var f=(function(h){c(i,h);function i(j){h.call(this,j);this.Value=j.Value}i.prototype._Compile=function(){var j=this;return function(k){return j.Value}};i.ConstantParameter="__constants";i.GenerateConstantId=(function(){var j=0;return function(){return"constant-"+(++j)}})();return i})(g.Expression);g.ConstantExpression=f})(e||(e={}));var c=this.__extends||function(h,g){for(var i in g){if(g.hasOwnProperty(i)){h[i]=g[i]}}function f(){this.constructor=h}f.prototype=g.prototype;h.prototype=new f()};var e;(function(g){var f=(function(h){c(i,h);function i(j){h.call(this,j)}i.prototype._Compile=function(){return function(j){return null}};return i})(g.Expression);g.DefaultExpression=f})(e||(e={}));var c=this.__extends||function(h,g){for(var i in g){if(g.hasOwnProperty(i)){h[i]=g[i]}}function f(){this.constructor=h}f.prototype=g.prototype;h.prototype=new f()};var e;(function(g){var f=(function(h){c(i,h);function i(j){h.call(this,j);g.Sanitizer.Require(j,{inputName:"Expression",inputType:"object"},{inputName:"Arguments",inputConstructor:Array});this.Expression=g.Expression.CreateExpression(j.Expression);this.Arguments=linq(j.Arguments).Select(function(k){return g.Expression.CreateExpression(k)}).Result}i.prototype._Compile=function(){var k=this.Expression.Compile();var j=linq(this.Arguments).Select(function(l){return l.Compile()}).Result;return function(l){var m=k(l);var n=linq(j).Select(function(o){return o(l)}).Result;return m.apply(l,n)}};return i})(g.Expression);g.InvocationExpression=f})(e||(e={}));var c=this.__extends||function(h,g){for(var i in g){if(g.hasOwnProperty(i)){h[i]=g[i]}}function f(){this.constructor=h}f.prototype=g.prototype;h.prototype=new f()};var e;(function(g){var f=(function(h){c(i,h);function i(j){h.call(this,j);g.Sanitizer.Require(j,{inputName:"Expression",inputType:"object",allowNull:true},{inputName:"MemberName",inputConstructor:String});this.Expression=j.Expression?g.Expression.CreateExpression(j.Expression):null;this.MemberName=j.MemberName}i.prototype._Compile=function(){if(!i.PropertyRegex.test(this.MemberName)){throw"Invalid property name: "+this.MemberName}if(this.Expression){var k=this.MemberName;var j=this.Expression.Compile();return function(l){return j(l)[k]}}else{throw"Not implemented exception"}};i.PropertyRegex=new RegExp("^[_a-zA-Z][_a-zA-Z0-9]*$");return i})(g.Expression);g.MemberExpression=f})(e||(e={}));var c=this.__extends||function(h,g){for(var i in g){if(g.hasOwnProperty(i)){h[i]=g[i]}}function f(){this.constructor=h}f.prototype=g.prototype;h.prototype=new f()};var e;(function(g){var f=(function(h){c(i,h);function i(j){h.call(this,j);g.Sanitizer.Require(j,{inputName:"Object",inputType:"object",allowNull:true},{inputName:"Arguments",inputConstructor:Array},{inputName:"MethodName",inputConstructor:String},{inputName:"MethodFullName",inputConstructor:String});this.Object=j.Object?g.Expression.CreateExpression(j.Object):null;this.Arguments=linq(j.Arguments).Select(function(k){return g.Expression.CreateExpression(k)}).Result;this.MethodName=j.MethodName;this.MethodFullName=j.MethodFullName}i.prototype._Compile=function(){var j=this;if(!g.MemberExpression.PropertyRegex.test(this.MethodName)){throw"Invalid method name: "+this.MethodName}var l=this.Object?this.Object.Compile():function(m){return window};var k=linq(this.Arguments).Select(function(m){return m.Compile()}).Result;return function(m){var n=l(m);var p=linq(k).Select(function(o){return o(m)}).Result;return(n[j.MethodName]?n[j.MethodName]:i.RegisteredMethods[j.MethodFullName]).apply(n,p)}};i.RegisteredMethods={};return i})(g.Expression);g.MethodCallExpression=f})(e||(e={}));var c=this.__extends||function(h,g){for(var i in g){if(g.hasOwnProperty(i)){h[i]=g[i]}}function f(){this.constructor=h}f.prototype=g.prototype;h.prototype=new f()};var e;(function(g){var f=(function(h){c(i,h);function i(j){h.call(this,j);g.Sanitizer.Require(j,{inputName:"Arguments",inputConstructor:Array},{inputName:"IsAnonymous",inputConstructor:Boolean},{inputName:"Type",inputConstructor:String});if(j.IsAnonymous){g.Sanitizer.Require(j,{inputName:"Members",inputConstructor:Array});if(j.Members.length!==j.Arguments.length){throw"If members are defined, each must have a corresponding argument"}}this.Arguments=linq(j.Arguments).Select(function(k){return g.Expression.CreateExpression(k)}).Result;this.Members=j.Members;this.Type=j.Type;this.IsAnonymous=j.IsAnonymous}i.prototype._Compile=function(){var j=this;var k=linq(this.Arguments).Select(function(l){return l.Compile()}).Result;return function(l){var m=linq(k).Select(function(n){return n(l)}).Result;if(j.IsAnonymous){return j.ConstructAnonymous(m)}else{if(i.RegisteredTypes[j.Type]){return i.Construct(i.RegisteredTypes[j.Type],m)}else{return{}}}}};i.prototype.ConstructAnonymous=function(m){var l={};for(var j=0,k=this.Members.length;j<k;j++){l[this.Members[j]]=m[j]}return l};i.Construct=function(k,j){var l=Object.create(k.prototype);var m=k.apply(l,j);return typeof m==="object"?m:l};i.RegisteredTypes={};return i})(g.Expression);g.NewExpression=f})(e||(e={}));var c=this.__extends||function(h,g){for(var i in g){if(g.hasOwnProperty(i)){h[i]=g[i]}}function f(){this.constructor=h}f.prototype=g.prototype;h.prototype=new f()};var e;(function(g){var f=(function(h){c(i,h);function i(j){h.call(this,j);g.Sanitizer.Require(j,{inputName:"Name",inputConstructor:String});this.Name=j.Name}i.prototype._Compile=function(){var j=this;return function(k){return k[j.Name]}};return i})(g.Expression);g.ParameterExpression=f})(e||(e={}));var e;(function(g){g.Initialize=function(h){};var f=(function(){function h(){}h.Require=function(m){var o=[];for(var j=0;j<(arguments.length-1);j++){o[j]=arguments[j+1]}if(m==null){throw"Item must have a value"}for(var k=0,l=o.length;k<l;k++){var n=o[k];if(n.allowNull&&m[n.inputName]==null){return}if(!n.allowNull&&m[n.inputName]==null){throw"Property "+n.inputName+" cannot be null"}if(n.inputType&&typeof m[n.inputName]!==n.inputType){throw"Property "+n.inputName+" must be of type "+n.inputType}if(n.inputConstructor&&m[n.inputName].constructor!==n.inputConstructor){throw {message:"Property "+n.inputName+" must be of a give type",type:n.inputConstructor}}}};return h})();g.Sanitizer=f})(e||(e={}));var c=this.__extends||function(h,g){for(var i in g){if(g.hasOwnProperty(i)){h[i]=g[i]}}function f(){this.constructor=h}f.prototype=g.prototype;h.prototype=new f()};var e;(function(g){var f=(function(h){c(i,h);function i(j){h.call(this,j);g.Sanitizer.Require(j,{inputName:"Operand",inputType:"object"});this.Operand=g.Expression.CreateExpression(j.Operand)}i.prototype._Compile=function(){var j=this;var k=this.Operand.Compile();return function(l){return i.OperatorDictionary[j.NodeType](k(l))}};i.OperatorDictionary=(function(){var j=[];j[g.Meta.ExpressionType.Convert]=function(k){return k};j[g.Meta.ExpressionType.Not]=function(k){return !k};return j})();i.OperatorStringDictionary=(function(){var j=[];j[g.Meta.ExpressionType.Convert]=function(k){return k};j[g.Meta.ExpressionType.Not]=function(k){return"!"+k};return j})();return i})(g.Expression);g.UnaryExpression=f})(e||(e={}));var d=(function(){function f(){}f.createExpression=e.Expression.CreateExpression;f.registeredConstructors=e.NewExpression.RegisteredTypes;f.registeredMethods=e.MethodCallExpression.RegisteredMethods;return f})();window.ex=d;window.WebExpressions=e})();(function(d){var e,f,g,i;var l=/^[\w\d_]+(,([\w\d_]+))*$/;var k=/^[\s\t\r\n]*\{.*\}[\s\t\r\n]*$/;var m=/[\s\t\r\n]/g;var c=function(n,o){return h(n).Union(o).Result};d.Linq=function(n){this.Result=h.utils.transformToArray(n)};d.linq=function(n){return new d.Linq(n?n:[])};var h=d.linq;h.utils={convertLambda:function(n){if(!n||n.constructor===Function){return n}else{if(n.constructor!==String){throw"Invalid linq function"}else{if(n.indexOf("=>")===-1){throw'"=>" expression not found'}}}var p=n.substring(n.indexOf("=>")+2);var o=n.substring(0,n.indexOf("=>")).replace(m,"");if(o.indexOf("(")===0){o=o.substring(1);if(o.indexOf(")")===o.length-1){o=o.substring(0,o.length-1)}else{throw"Invalid left hand side"}}if(o.length<1||!l.test(o)){throw"Invalid left hand side"}else{if(p.length<1){throw"Invalid right hand side"}}if(k.test(p)){return new Function(o,p)}else{return new Function(o,"return "+p+";")}},transformToArray:function(n){if(n.constructor===Array){return n}else{if(n.constructor===d.Linq){return n.Result}else{if(n.constructor===NodeList){return n}else{throw"Input must be array or Linq object"}}}},transformToLinq:function(n){if(n.constructor===d.Linq){return n}else{if(n.constructor===Array){return h(n)}else{throw"Input must be array or Linq object"}}}};h.fn=d.Linq.prototype;h.fn.Select=function(q){q=h.utils.convertLambda(q);var p=h();for(var n=0,o=this.Result.length;n<o;n++){p.Result[n]=q(this.Result[n])}return p};var j=function(o,p){p=h.utils.convertLambda(p);var n=function(r){return r!=null&&r.constructor===Number};var q=(p?o.Select(p):o).Where(n).Result;if(q.length===0){throw"Sequence contains no elements."}return q};h.fn.Max=function(n){return Math.max.apply(Math,j(this,n))};h.fn.Min=function(n){return Math.min.apply(Math,j(this,n))};h.fn.Aggregate=function(n){if(n===undefined){n=c}else{n=h.utils.convertLambda(n)}var q=h();for(var o=0,p=this.Result.length;o<p;o++){q.Result=n(q.Result,this.Result[o])}return q};h.fn.Union=function(n){n=h.utils.transformToArray(n);var r=h();var o;for(o=0,e=this.Result.length;o<e;o++){r.Result[o]=this.Result[o]}for(var p=0,q=n.length;p<q;p++){if(!r.Contains(n[p])){r.Result[o+p]=n[p]}else{o--}}return r};h.fn.Contains=function(n){for(var o=0,p=this.Result.length;o<p;o++){if(this.Result[o]===n){return true}}return false};h.fn.Any=function(p){if(!p){return this.Result.length>0}p=h.utils.convertLambda(p);for(var n=0,o=this.Result.length;n<o;n++){if(p(this.Result[n])){return true}}return false};h.fn.Where=function(r){r=h.utils.convertLambda(r);var q=0;var p=h();for(var n=0,o=this.Result.length;n<o;n++){if(r(this.Result[n])){p.Result[n-q]=this.Result[n]}else{q++}}return p};h.fn.First=function(p){if(!p){return this.Result[0]}else{p=h.utils.convertLambda(p);for(var n=0,o=this.Result.length;n<o;n++){if(p(this.Result[n])){return this.Result[n]}}}return null};h.fn.Last=function(o){if(!o){return this.Result[this.Result.length-1]}else{o=h.utils.convertLambda(o);for(var n=this.Result.length-1;n>=0;n--){if(o(this.Result[n])){return this.Result[n]}}}return null};h.fn.GroupBy=function(r){r=h.utils.convertLambda(r);var q=h();var p=null;var s=null;for(var n=0,o=this.Result.length;n<o;n++){p=r(this.Result[n]);s=q.Where(function(t){return t.key===p});if(s.Any()){s.Result[0].values.push(this.Result[n])}else{q.Result.push({key:p,values:[this.Result[n]]})}}return q};h.fn.OrderBy=function(s){s=h.utils.convertLambda(s);var n=new Object();var q=h();var w=[];var v=[];var u=null;for(var o=0,p=this.Result.length;o<p;o++){var r=s?s(this.Result[o]):this.Result[o];w[o]={key:o,value:r};v[o]={key:o,value:this.Result[o]};if(r&&u==null){u=typeof r==="number"?n:r.constructor}else{if(r&&u!==(typeof r==="number"?n:r.constructor)){throw"Invalid comparison type"}}}var t=function(x,y){if(x.value<y.value){return -1}else{if(x.value>y.value){return 1}else{return 0}}};w.sort(t);for(var o=0,p=w.length;o<p;o++){q.Result[o]=h(v).First(function(x){return x.key===w[o].key}).value}return q};h.fn.OrderByDecending=function(o){var n=this.OrderBy(h.utils.convertLambda(o));n.Result.reverse();return n};h.fn.Skip=function(q){var p=h();for(var n=q,o=this.Result.length;n<o;n++){p.Result[n-q]=this.Result[n]}return p};h.fn.Take=function(q){var p=h();var o=q<this.Result.length?q:this.Result.length;for(var n=0;n<o;n++){p.Result[n]=this.Result[n]}return p};h.fn.Distinct=function(){var q=0;var p=h();for(var n=0,o=this.Result.length;n<o;n++){if(!p.Contains(this.Result[n])){p.Result[n-q]=this.Result[n]}else{q++}}return p};h.fn.Each=function(p){p=h.utils.convertLambda(p);for(var n=0,o=this.Result.length;n<o;n++){p(this.Result[n],n)}return this};h.fn.ReverseEach=function(o){o=h.utils.convertLambda(o);for(var n=this.Result.length-1;n>=0;n--){o(this.Result[n],n)}return this}})(window);var b;(function(c){(function(e){var f=(function(){function g(i,h){this.Entity=h;this.Rules=linq(i||[]).Select(g.CreateRule).Result}g.CreateRule=function(i){var h=ex.createExpression(i.Expression).Compile();return{RequiredForValidation:linq(i.RequiredForValidation).Select(function(j){return g.MemberChainItemString(j,true)}).Result,ValidationSubjects:linq(i.ValidationSubjects).Select(function(j){return g.MemberChainItemString(j,true)}).Result,Validate:function(l,j){if(typeof j==="undefined"){j=false}var k={};k[i.EntityParameter]=l;k[i.ContextParameter]={Violations:[],BreakOnFirstError:j,Mocks:[],Dependencies:{}};h(k);return k[i.ContextParameter].Violations}}};g.MemberChainItemString=function(h,j){if(j){h=h.NextItem}var i=[];while(h){i.push(h.MemberName);h=h.NextItem}return i.join(".")};g.prototype.Validate=function(j,h){if(typeof h==="undefined"){h=false}var i=this.GetEntity();return linq(this.Rules).Where(function(k){return k.ValidationSubjects.indexOf(j)!==-1}).Select(function(k){return k.Validate(i,h)}).Aggregate().Where(function(k){return g.FilterViolation(k,j)}).Result};g.prototype.GetEntity=function(){throw"Invalid operation, this method is abstract"};g.FilterViolation=function(i,h){return linq(i.Violated).Any(function(j){return g.MemberChainItemString(j,true)===h})};return g})();e.Validator=f})(c.Validation||(c.Validation={}));var d=c.Validation})(b||(b={}));var b;(function(c){var d=(function(){function e(){}e.Bootstrap=function(){if(e._Initialized){return}e._Initialized=true;e._InitializeConstructors();e._InitializeMethods()};e._InitializeConstructors=function(){ex.registeredConstructors["BackToFront.Utilities.SimpleViolation"]=function(f){this.UserMessage=f}};e._InitializeMethods=function(){ex.registeredMethods["System.Collections.Generic.ICollection`1[[BackToFront.IViolation, BackToFront, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]].Add"]=function(f){if(!this||!this.push||this.push.constructor!==Function){throw"This method must be called on an array##"}this.push(f)};ex.registeredMethods["System.String.IsNullOrEmpty"]=function(f){return !f};ex.registeredMethods["System.String.IsNullOrWhiteSpace"]=function(f){return !f||!f.trim()}};e._Initialized=false;return e})();c.Initialize=d})(b||(b={}));b.Initialize.Bootstrap();var b;(function(c){var d=(function(){function e(){}e.Require=function(j){var l=[];for(var f=0;f<(arguments.length-1);f++){l[f]=arguments[f+1]}if(j==null){throw"Item must have a value"}for(var g=0,h=l.length;g<h;g++){var k=l[g];if(k.allowNull&&j[k.inputName]==null){return}if(!k.allowNull&&j[k.inputName]==null){throw"Property "+k.inputName+" cannot be null"}if(k.inputType&&typeof j[k.inputName]!==k.inputType){throw"Property "+k.inputName+" must be of type "+k.inputType}if(k.inputConstructor&&j[k.inputName].constructor!==k.inputConstructor){throw {message:"Property "+k.inputName+" must be of a give type",type:k.inputConstructor}}}};return e})();c.Sanitizer=d})(b||(b={}));var a=this.__extends||function(f,e){for(var g in e){if(e.hasOwnProperty(g)){f[g]=e[g]}}function c(){this.constructor=f}c.prototype=e.prototype;f.prototype=new c()};var b;(function(c){(function(g){var e=(function(){function h(i){if(typeof i==="undefined"){i=[]}this.Errors=i}return h})();g.JqueryBTFContext=e;var f=(function(h){a(i,h);function i(l,k,j){h.call(this,l,k);this.Context=j;i.Setup()}i.prototype.GetEntity=function(){var l={};var k=linq(this.Rules).Select(function(j){return linq(j.RequiredForValidation||[]).Union(j.ValidationSubjects||[]).Result}).Aggregate().Result;for(var n=0,o=k.length;n<o;n++){var m=jQuery('[name="'+k[n]+'"]',this.Context);if(m.attr("type")==="checkbox"){l[k[n]]=m.is(":checked")}else{l[k[n]]=m.val();if(m.attr("data-val-number")){if(!l[k[n]]){l[k[n]]=null}else{l[k[n]]=l[k[n]].indexOf(".")!==-1?parseFloat(l[k[n]]):parseInt(l[k[n]])}}}}return l};i.RegisterRule=function(j){c.Sanitizer.Require(j,{inputName:"Rules",inputConstructor:Array},{inputName:"Entity",inputConstructor:String});i.Registered.push(new i(j.Rules,j.Entity))};i.Setup=function(){if(!jQuery||!jQuery.validator){throw"This item requires jQuery and jQuery validation"}if(jQuery.validator.methods[i.ValidatorName]){return}jQuery.validator.addMethod(i.ValidatorName,i.Validate,i.HandlerErrors);if(jQuery.validator.unobtrusive&&jQuery.validator.unobtrusive.adapters){jQuery.validator.unobtrusive.adapters.add(i.ValidatorName,[],i.AddOptions)}};i.HandlerErrors=function(){if(this["__BTFContext"]&&this["__BTFContext"].Errors&&this["__BTFContext"].Errors.length){return i.JoinErrors(linq(this["__BTFContext"].Errors).Select(function(j){return j.UserMessage}).Result)}else{return undefined}};i.AddOptions=function(j){j.rules[i.ValidatorName]=j.params};i.Validate=function(n,k){var l=[];for(var j=0;j<(arguments.length-2);j++){l[j]=arguments[j+2]}var m=linq(i.Registered).Select(function(o){return o.Validate($(k).attr("name"),false)}).Aggregate();this["__BTFContext"]=new e(m.Result);return m.Result.length===0};i.JoinErrors=function(j){return j.join("<br />")};i.Registered=[];i.ValidatorName="backtofront";return i})(c.Validation.Validator);g.JQueryValidator=f})(c.Validation||(c.Validation={}));var d=c.Validation})(b||(b={}));window.__BTF=b})();