(function(){(function(){(function(j){var k,l,m,o;var r=/^[\w\d_]+(,([\w\d_]+))*$/;var q=/^[\s\t\r\n]*\{.*\}[\s\t\r\n]*$/;var s=/[\s\t\r\n]/g;var i=function(t,u){return n(t).Union(u).Result};j.Linq=function(t){this.Result=n.utils.transformToArray(t)};j.linq=function(t){return new j.Linq(t?t:[])};var n=j.linq;n.utils={convertLambda:function(t){if(!t||t.constructor===Function){return t}else{if(t.constructor!==String){throw"Invalid linq function"}else{if(t.indexOf("=>")===-1){throw'"=>" expression not found'}}}var v=t.substring(t.indexOf("=>")+2);var u=t.substring(0,t.indexOf("=>")).replace(s,"");if(u.indexOf("(")===0){u=u.substring(1);if(u.indexOf(")")===u.length-1){u=u.substring(0,u.length-1)}else{throw"Invalid left hand side"}}if(u.length<1||!r.test(u)){throw"Invalid left hand side"}else{if(v.length<1){throw"Invalid right hand side"}}if(q.test(v)){return new Function(u,v)}else{return new Function(u,"return "+v+";")}},transformToArray:function(t){if(t.constructor===Array){return t}else{if(t.constructor===j.Linq){return t.Result}else{if(t.constructor===NodeList){return t}else{throw"Input must be array or Linq object"}}}},transformToLinq:function(t){if(t.constructor===j.Linq){return t}else{if(t.constructor===Array){return n(t)}else{throw"Input must be array or Linq object"}}}};n.fn=j.Linq.prototype;n.fn.Select=function(w){w=n.utils.convertLambda(w);var v=n();for(var t=0,u=this.Result.length;t<u;t++){v.Result[t]=w(this.Result[t])}return v};var p=function(u,v){v=n.utils.convertLambda(v);var t=function(x){return x!=null&&x.constructor===Number};var w=(v?u.Select(v):u).Where(t).Result;if(w.length===0){throw"Sequence contains no elements."}return w};n.fn.Max=function(t){return Math.max.apply(Math,p(this,t))};n.fn.Min=function(t){return Math.min.apply(Math,p(this,t))};n.fn.Aggregate=function(t){if(t===undefined){t=i}else{t=n.utils.convertLambda(t)}var w=n();for(var u=0,v=this.Result.length;u<v;u++){w.Result=t(w.Result,this.Result[u])}return w};n.fn.Union=function(t){t=n.utils.transformToArray(t);var x=n();var u;for(u=0,k=this.Result.length;u<k;u++){x.Result[u]=this.Result[u]}for(var v=0,w=t.length;v<w;v++){if(!x.Contains(t[v])){x.Result[u+v]=t[v]}else{u--}}return x};n.fn.Contains=function(t){for(var u=0,v=this.Result.length;u<v;u++){if(this.Result[u]===t){return true}}return false};n.fn.Any=function(v){if(!v){return this.Result.length>0}v=n.utils.convertLambda(v);for(var t=0,u=this.Result.length;t<u;t++){if(v(this.Result[t])){return true}}return false};n.fn.Where=function(x){x=n.utils.convertLambda(x);var w=0;var v=n();for(var t=0,u=this.Result.length;t<u;t++){if(x(this.Result[t])){v.Result[t-w]=this.Result[t]}else{w++}}return v};n.fn.First=function(v){if(!v){return this.Result[0]}else{v=n.utils.convertLambda(v);for(var t=0,u=this.Result.length;t<u;t++){if(v(this.Result[t])){return this.Result[t]}}}return null};n.fn.Last=function(u){if(!u){return this.Result[this.Result.length-1]}else{u=n.utils.convertLambda(u);for(var t=this.Result.length-1;t>=0;t--){if(u(this.Result[t])){return this.Result[t]}}}return null};n.fn.GroupBy=function(x){x=n.utils.convertLambda(x);var w=n();var v=null;var y=null;for(var t=0,u=this.Result.length;t<u;t++){v=x(this.Result[t]);y=w.Where(function(z){return z.key===v});if(y.Any()){y.Result[0].values.push(this.Result[t])}else{w.Result.push({key:v,values:[this.Result[t]]})}}return w};n.fn.OrderBy=function(y){y=n.utils.convertLambda(y);var t=new Object();var w=n();var C=[];var B=[];var A=null;for(var u=0,v=this.Result.length;u<v;u++){var x=y?y(this.Result[u]):this.Result[u];C[u]={key:u,value:x};B[u]={key:u,value:this.Result[u]};if(x&&A==null){A=typeof x==="number"?t:x.constructor}else{if(x&&A!==(typeof x==="number"?t:x.constructor)){throw"Invalid comparison type"}}}var z=function(D,E){if(D.value<E.value){return -1}else{if(D.value>E.value){return 1}else{return 0}}};C.sort(z);for(var u=0,v=C.length;u<v;u++){w.Result[u]=n(B).First(function(D){return D.key===C[u].key}).value}return w};n.fn.OrderByDecending=function(u){var t=this.OrderBy(n.utils.convertLambda(u));t.Result.reverse();return t};n.fn.Skip=function(w){var v=n();for(var t=w,u=this.Result.length;t<u;t++){v.Result[t-w]=this.Result[t]}return v};n.fn.Take=function(w){var v=n();var u=w<this.Result.length?w:this.Result.length;for(var t=0;t<u;t++){v.Result[t]=this.Result[t]}return v};n.fn.Distinct=function(){var w=0;var v=n();for(var t=0,u=this.Result.length;t<u;t++){if(!v.Contains(this.Result[t])){v.Result[t-w]=this.Result[t]}else{w++}}return v};n.fn.Each=function(v){v=n.utils.convertLambda(v);for(var t=0,u=this.Result.length;t<u;t++){v(this.Result[t],t)}return this};n.fn.ReverseEach=function(u){u=n.utils.convertLambda(u);for(var t=this.Result.length-1;t>=0;t--){u(this.Result[t],t)}return this}})(window);var g;(function(j){var i=(function(){function k(l,m){this.x=l;this.y=m}k.prototype.getDist=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};k.origin=new k(0,0);return k})();j.Point=i})(g||(g={}));var f=new g.Point(3,4);var d=f.getDist();var h;(function(j){(function(n){var k=(function(){function o(){}o.GetClass=function(q){var p=o.SplitNamespace(q);var t=window;for(var r=0,s=p.length;r<s;r++){t=t[p[r]];if(t==undefined){throw"Cannot evaluate member "+p}}return t};o.SplitNamespace=function(p){var q=p.split(".");linq(q).Each(function(r){if(!o.PropertyRegex.test(r)){throw"Invalid namespace part "+r}});return q};o.AddStaticItem=function(p,s){var t=o.SplitNamespace(p);if(t.length<2){throw"Invalid namespace"}var s=window;var q=0;for(var r=t.length-2;q<r;q++){if(!s[t[q]]){s=(s[t[q]]={})}else{s=s[t[q]]}}if(!s[t[q]]){s=(s[t[q]]=function(){})}};o.PropertyRegex=new RegExp("^[_a-zA-Z][_a-zA-Z0-9]*$");return o})();n.CustomClassHandler=k;var m=(function(){function o(p,q){this.Key=p;this.Value=q}return o})();var l=(function(){function o(){this._InnerDictionary=[]}o.prototype.ContainsKey=function(p){return linq(this._InnerDictionary).Any(function(q){return q.Key===p})};o.prototype.Add=function(p,q){if(this.ContainsKey(p)){throw"Dictionary alredy contains the key "+p}this._InnerDictionary.push(new m(p,q))};o.prototype.AddOrReplace=function(q,r){var p=linq(this._InnerDictionary).First(function(s){return s.Key===q});if(p){p.Value=r}else{this._InnerDictionary.push(new m(q,r))}};o.prototype.Value=function(q){var p=linq(this._InnerDictionary).First(function(r){return r.Key===q});return p?p.Value:null};o.prototype.Remove=function(r){for(var p=0,q=this._InnerDictionary.length;p<q;p++){if(this._InnerDictionary[p].Key===r){this._InnerDictionary.splice(p,1);return true}}return false};o.prototype.Merge=function(p){if(p){for(var q=0,r=p._InnerDictionary.length;q<r;q++){var s=p._InnerDictionary[q];this.Add(s.Key,s.Value)}}return this};return o})();n.Dictionary=l})(j.Utils||(j.Utils={}));var i=j.Utils})(h||(h={}));var h;(function(j){(function(m){(function(n){n[n.Binary=1]="Binary";n[n.Constant=2]="Constant";n[n.Member=3]="Member";n[n.StaticMember=4]="StaticMember";n[n.MethodCall=5]="MethodCall";n[n.StaticMethodCall=6]="StaticMethodCall";n[n.Parameter=7]="Parameter";n[n.Unary=8]="Unary";n[n.Default=9]="Default";n[n.Block=10]="Block";n[n.Conditional=11]="Conditional";n[n.Invocation=12]="Invocation";n[n.New=13]="New"})(m.ExpressionWrapperType||(m.ExpressionWrapperType={}));var l=m.ExpressionWrapperType;(function(n){n[n.Add=0]="Add";n[n.AddChecked=1]="AddChecked";n[n.And=2]="And";n[n.AndAlso=3]="AndAlso";n[n.ArrayLength=4]="ArrayLength";n[n.ArrayIndex=5]="ArrayIndex";n[n.Call=6]="Call";n[n.Coalesce=7]="Coalesce";n[n.Conditional=8]="Conditional";n[n.Constant=9]="Constant";n[n.Convert=10]="Convert";n[n.ConvertChecked=11]="ConvertChecked";n[n.Divide=12]="Divide";n[n.Equal=13]="Equal";n[n.ExclusiveOr=14]="ExclusiveOr";n[n.GreaterThan=15]="GreaterThan";n[n.GreaterThanOrEqual=16]="GreaterThanOrEqual";n[n.Invoke=17]="Invoke";n[n.Lambda=18]="Lambda";n[n.LeftShift=19]="LeftShift";n[n.LessThan=20]="LessThan";n[n.LessThanOrEqual=21]="LessThanOrEqual";n[n.ListInit=22]="ListInit";n[n.MemberAccess=23]="MemberAccess";n[n.MemberInit=24]="MemberInit";n[n.Modulo=25]="Modulo";n[n.Multiply=26]="Multiply";n[n.MultiplyChecked=27]="MultiplyChecked";n[n.Negate=28]="Negate";n[n.UnaryPlus=29]="UnaryPlus";n[n.NegateChecked=30]="NegateChecked";n[n.New=31]="New";n[n.NewArrayInit=32]="NewArrayInit";n[n.NewArrayBounds=33]="NewArrayBounds";n[n.Not=34]="Not";n[n.NotEqual=35]="NotEqual";n[n.Or=36]="Or";n[n.OrElse=37]="OrElse";n[n.Parameter=38]="Parameter";n[n.Power=39]="Power";n[n.Quote=40]="Quote";n[n.RightShift=41]="RightShift";n[n.Subtract=42]="Subtract";n[n.SubtractChecked=43]="SubtractChecked";n[n.TypeAs=44]="TypeAs";n[n.TypeIs=45]="TypeIs";n[n.Assign=46]="Assign";n[n.Block=47]="Block";n[n.DebugInfo=48]="DebugInfo";n[n.Decrement=49]="Decrement";n[n.Dynamic=50]="Dynamic";n[n.Default=51]="Default";n[n.Extension=52]="Extension";n[n.Goto=53]="Goto";n[n.Increment=54]="Increment";n[n.Index=55]="Index";n[n.Label=56]="Label";n[n.RuntimeVariables=57]="RuntimeVariables";n[n.Loop=58]="Loop";n[n.Switch=59]="Switch";n[n.Throw=60]="Throw";n[n.Try=61]="Try";n[n.Unbox=62]="Unbox";n[n.AddAssign=63]="AddAssign";n[n.AndAssign=64]="AndAssign";n[n.DivideAssign=65]="DivideAssign";n[n.ExclusiveOrAssign=66]="ExclusiveOrAssign";n[n.LeftShiftAssign=67]="LeftShiftAssign";n[n.ModuloAssign=68]="ModuloAssign";n[n.MultiplyAssign=69]="MultiplyAssign";n[n.OrAssign=70]="OrAssign";n[n.PowerAssign=71]="PowerAssign";n[n.RightShiftAssign=72]="RightShiftAssign";n[n.SubtractAssign=73]="SubtractAssign";n[n.AddAssignChecked=74]="AddAssignChecked";n[n.MultiplyAssignChecked=75]="MultiplyAssignChecked";n[n.SubtractAssignChecked=76]="SubtractAssignChecked";n[n.PreIncrementAssign=77]="PreIncrementAssign";n[n.PreDecrementAssign=78]="PreDecrementAssign";n[n.PostIncrementAssign=79]="PostIncrementAssign";n[n.PostDecrementAssign=80]="PostDecrementAssign";n[n.TypeEqual=81]="TypeEqual";n[n.OnesComplement=82]="OnesComplement";n[n.IsTrue=83]="IsTrue";n[n.IsFalse=84]="IsFalse"})(m.ExpressionType||(m.ExpressionType={}));var k=m.ExpressionType})(j.Meta||(j.Meta={}));var i=j.Meta})(h||(h={}));var h;(function(j){var i=(function(){function k(l){j.Sanitizer.Require(l,{inputName:"NodeType",inputConstructor:Number},{inputName:"ExpressionType",inputConstructor:Number});this.NodeType=l.NodeType;this.ExpressionType=l.ExpressionType}k.prototype.Compile=function(){if(!this._Compiled){this._Compiled=this._Compile()}return this._Compiled};k.prototype._Compile=function(){throw"Invalid operation"};k.prototype.GetAffectedProperties=function(){return[]};k.CreateExpression=function(l){if(l.NodeType===j.Meta.ExpressionType.Assign&&l.ExpressionType===j.Meta.ExpressionWrapperType.Binary){return new j.AssignmentExpression(l)}if(k.ExpressionConstructorDictionary[l.ExpressionType]){return k.ExpressionConstructorDictionary[l.ExpressionType](l)}throw"Invalid expression type"};k.ExpressionConstructorDictionary=(function(){var l={};l[j.Meta.ExpressionWrapperType.Binary]=function(m){return new j.BinaryExpression(m)};l[j.Meta.ExpressionWrapperType.Block]=function(m){return new j.BlockExpression(m)};l[j.Meta.ExpressionWrapperType.Conditional]=function(m){return new j.ConditionalExpression(m)};l[j.Meta.ExpressionWrapperType.Constant]=function(m){return new j.ConstantExpression(m)};l[j.Meta.ExpressionWrapperType.Default]=function(m){return new j.DefaultExpression(m)};l[j.Meta.ExpressionWrapperType.Member]=function(m){return new j.MemberExpression(m)};l[j.Meta.ExpressionWrapperType.StaticMember]=function(m){return new j.StaticMemberExpression(m)};l[j.Meta.ExpressionWrapperType.MethodCall]=function(m){return new j.MethodCallExpression(m)};l[j.Meta.ExpressionWrapperType.StaticMethodCall]=function(m){return new j.StaticMethodCallExpression(m)};l[j.Meta.ExpressionWrapperType.Parameter]=function(m){return new j.ParameterExpression(m)};l[j.Meta.ExpressionWrapperType.Unary]=function(m){return new j.UnaryExpression(m)};l[j.Meta.ExpressionWrapperType.Invocation]=function(m){return new j.InvocationExpression(m)};l[j.Meta.ExpressionWrapperType.New]=function(m){return new j.NewExpression(m)};return l})();return k})();j.Expression=i})(h||(h={}));var c=this.__extends||function(k,j){for(var l in j){if(j.hasOwnProperty(l)){k[l]=j[l]}}function i(){this.constructor=k}i.prototype=j.prototype;k.prototype=new i()};var h;(function(j){var i=(function(k){c(l,k);function l(m){k.call(this,m);j.Sanitizer.Require(m,{inputName:"Left",inputType:"object"},{inputName:"Right",inputType:"object"});switch(m.Left.ExpressionType){case j.Meta.ExpressionWrapperType.Parameter:this.Left=null;this.LeftProperty=(m.Left).Name;break;case j.Meta.ExpressionWrapperType.StaticMember:case j.Meta.ExpressionWrapperType.Member:this.Left=j.Expression.CreateExpression((m.Left).Expression);this.LeftProperty=(m.Left).MemberName;break;default:throw"The left hand side of an assignment must be a parameter or a member"}this.Right=j.Expression.CreateExpression(m.Right)}l.prototype._Compile=function(){var m=this;var n=this.Left?this.Left.Compile():function(p){return p};var o=this.Right.Compile();return function(p){return n(p)[m.LeftProperty]=o(p)}};return l})(j.Expression);j.AssignmentExpression=i})(h||(h={}));var c=this.__extends||function(k,j){for(var l in j){if(j.hasOwnProperty(l)){k[l]=j[l]}}function i(){this.constructor=k}i.prototype=j.prototype;k.prototype=new i()};var h;(function(k){var j=k.Meta;var i=(function(l){c(m,l);function m(n){l.call(this,n);if(!m.OperatorDictionary[this.NodeType]){throw"##Invalid Operator"}k.Sanitizer.Require(n,{inputName:"Left",inputType:"object"},{inputName:"Right",inputType:"object"});this.Left=k.Expression.CreateExpression(n.Left);this.Right=k.Expression.CreateExpression(n.Right)}m.prototype._Compile=function(){var n=this;if(!m.OperatorStringDictionary[this.NodeType]){throw"Invalid expression type"}var o=this.Left.Compile();var p=this.Right.Compile();return function(q){return m.OperatorDictionary[n.NodeType](o(q),p(q))}};m.OperatorDictionary=(function(){var n=[];n[k.Meta.ExpressionType.Add]=function(o,p){return o+p};n[k.Meta.ExpressionType.AndAlso]=function(o,p){return o&&p};n[k.Meta.ExpressionType.Divide]=function(o,p){return o/p};n[k.Meta.ExpressionType.Equal]=function(o,p){return o===p};n[k.Meta.ExpressionType.GreaterThan]=function(o,p){return o>p};n[k.Meta.ExpressionType.GreaterThanOrEqual]=function(o,p){return o>=p};n[k.Meta.ExpressionType.LessThan]=function(o,p){return o<p};n[k.Meta.ExpressionType.LessThanOrEqual]=function(o,p){return o<=p};n[k.Meta.ExpressionType.Multiply]=function(o,p){return o*p};n[k.Meta.ExpressionType.NotEqual]=function(o,p){return o!==p};n[k.Meta.ExpressionType.OrElse]=function(o,p){return o||p};n[k.Meta.ExpressionType.Subtract]=function(o,p){return o-p};return n})();m.OperatorStringDictionary=(function(){var n=[];n[k.Meta.ExpressionType.Add]=" + ";n[k.Meta.ExpressionType.AndAlso]=" && ";n[k.Meta.ExpressionType.Divide]=" / ";n[k.Meta.ExpressionType.Equal]=" === ";n[k.Meta.ExpressionType.GreaterThan]=" > ";n[k.Meta.ExpressionType.GreaterThanOrEqual]=" >= ";n[k.Meta.ExpressionType.LessThan]=" < ";n[k.Meta.ExpressionType.LessThanOrEqual]=" <= ";n[k.Meta.ExpressionType.Multiply]=" * ";n[k.Meta.ExpressionType.NotEqual]=" !== ";n[k.Meta.ExpressionType.OrElse]=" || ";n[k.Meta.ExpressionType.Subtract]=" - ";return n})();return m})(k.Expression);k.BinaryExpression=i})(h||(h={}));var c=this.__extends||function(k,j){for(var l in j){if(j.hasOwnProperty(l)){k[l]=j[l]}}function i(){this.constructor=k}i.prototype=j.prototype;k.prototype=new i()};var h;(function(j){var i=(function(k){c(l,k);function l(m){k.call(this,m);j.Sanitizer.Require(m,{inputName:"Expressions",inputConstructor:Array});this.Expressions=linq(m.Expressions).Select(function(n){return j.Expression.CreateExpression(n)}).Result}l.prototype._Compile=function(){var m=linq(this.Expressions).Select(function(n){return n.Compile()}).Result;return function(n){return linq(m).Each(function(o){return o(n)})}};return l})(j.Expression);j.BlockExpression=i})(h||(h={}));var c=this.__extends||function(k,j){for(var l in j){if(j.hasOwnProperty(l)){k[l]=j[l]}}function i(){this.constructor=k}i.prototype=j.prototype;k.prototype=new i()};var h;(function(j){var i=(function(k){c(l,k);function l(m){k.call(this,m);j.Sanitizer.Require(m,{inputName:"IfTrue",inputType:"object"},{inputName:"IfFalse",inputType:"object"},{inputName:"Test",inputType:"object"});this.IfTrue=j.Expression.CreateExpression(m.IfTrue);this.IfFalse=j.Expression.CreateExpression(m.IfFalse);this.Test=j.Expression.CreateExpression(m.Test)}l.prototype._Compile=function(){var o=this.Test.Compile();var n=this.IfTrue.Compile();var m=this.IfFalse.Compile();return function(p){return o(p)?n(p):m(p)}};return l})(j.Expression);j.ConditionalExpression=i})(h||(h={}));var c=this.__extends||function(k,j){for(var l in j){if(j.hasOwnProperty(l)){k[l]=j[l]}}function i(){this.constructor=k}i.prototype=j.prototype;k.prototype=new i()};var h;(function(j){var i=(function(k){c(l,k);function l(m){k.call(this,m);this.Value=m.Value}l.prototype._Compile=function(){var m=this;return function(n){return m.Value}};l.ConstantParameter="__constants";l.GenerateConstantId=(function(){var m=0;return function(){return"constant-"+(++m)}})();return l})(j.Expression);j.ConstantExpression=i})(h||(h={}));var c=this.__extends||function(k,j){for(var l in j){if(j.hasOwnProperty(l)){k[l]=j[l]}}function i(){this.constructor=k}i.prototype=j.prototype;k.prototype=new i()};var h;(function(j){var i=(function(k){c(l,k);function l(m){k.call(this,m)}l.prototype._Compile=function(){return function(m){return null}};return l})(j.Expression);j.DefaultExpression=i})(h||(h={}));var c=this.__extends||function(k,j){for(var l in j){if(j.hasOwnProperty(l)){k[l]=j[l]}}function i(){this.constructor=k}i.prototype=j.prototype;k.prototype=new i()};var h;(function(j){var i=(function(k){c(l,k);function l(m){k.call(this,m);j.Sanitizer.Require(m,{inputName:"Expression",inputType:"object"},{inputName:"Arguments",inputConstructor:Array});this.Expression=j.Expression.CreateExpression(m.Expression);this.Arguments=linq(m.Arguments).Select(function(n){return j.Expression.CreateExpression(n)}).Result}l.prototype._Compile=function(){var n=this.Expression.Compile();var m=linq(this.Arguments).Select(function(o){return o.Compile()}).Result;return function(o){var p=n(o);var q=linq(m).Select(function(r){return r(o)}).Result;return p.apply(o,q)}};return l})(j.Expression);j.InvocationExpression=i})(h||(h={}));var c=this.__extends||function(k,j){for(var l in j){if(j.hasOwnProperty(l)){k[l]=j[l]}}function i(){this.constructor=k}i.prototype=j.prototype;k.prototype=new i()};var h;(function(l){var j=(function(m){c(n,m);function n(o){m.call(this,o);l.Sanitizer.Require(o,{inputName:"MemberName",inputConstructor:String});this.MemberName=o.MemberName}n.prototype._Compile=function(){if(!l.Utils.CustomClassHandler.PropertyRegex.test(this.MemberName)){throw"Invalid property name: "+this.MemberName}var p=this.MemberName;var o=this._CompileMemberContext();return function(q){return o(q)[p]}};n.prototype._CompileMemberContext=function(){throw"This method is abstract"};return n})(l.Expression);l.MemberExpressionBase=j;var i=(function(m){c(n,m);function n(o){m.call(this,o);l.Sanitizer.Require(o,{inputName:"Expression",inputType:"object"});this.Expression=l.Expression.CreateExpression(o.Expression)}n.prototype._CompileMemberContext=function(){return this.Expression.Compile()};return n})(j);l.MemberExpression=i;var k=(function(m){c(n,m);function n(o){m.call(this,o);l.Sanitizer.Require(o,{inputName:"Class",inputType:"string"});this.Class=o.Class}n.prototype._CompileMemberContext=function(){var o=l.Utils.CustomClassHandler.GetClass(this.Class);return function(p){return o}};return n})(j);l.StaticMemberExpression=k})(h||(h={}));var c=this.__extends||function(k,j){for(var l in j){if(j.hasOwnProperty(l)){k[l]=j[l]}}function i(){this.constructor=k}i.prototype=j.prototype;k.prototype=new i()};var h;(function(l){var j=(function(m){c(n,m);function n(o){m.call(this,o);l.Sanitizer.Require(o,{inputName:"Arguments",inputConstructor:Array},{inputName:"MethodName",inputConstructor:String});this.Arguments=linq(o.Arguments).Select(function(p){return l.Expression.CreateExpression(p)}).Result;this.MethodName=o.MethodName}n.prototype._Compile=function(){var o=this;if(!l.Utils.CustomClassHandler.PropertyRegex.test(this.MethodName)){throw"Invalid method name: "+this.MethodName}var q=this.MethodName;var r=this._CompileMethodCallContext();var p=linq(this.Arguments).Select(function(s){return s.Compile()}).Result;return function(s){var u=linq(p).Select(function(v){return v(s)}).Result;var t=r(s);return t[o.MethodName].apply(t,u)}};n.prototype._CompileMethodCallContext=function(){throw"This method is abstract"};return n})(l.Expression);l.MethodCallExpressionBase=j;var i=(function(m){c(n,m);function n(o){m.call(this,o);l.Sanitizer.Require(o,{inputName:"Object",inputType:"object"});this.Object=l.Expression.CreateExpression(o.Object)}n.prototype._CompileMethodCallContext=function(){return this.Object.Compile()};n.RegisteredMethods={};return n})(j);l.MethodCallExpression=i;var k=(function(m){c(n,m);function n(o){m.call(this,o);l.Sanitizer.Require(o,{inputName:"Class",inputType:"string"});this.Class=o.Class}n.prototype._CompileMethodCallContext=function(){var o=l.Utils.CustomClassHandler.GetClass(this.Class);return function(p){return o}};return n})(j);l.StaticMethodCallExpression=k})(h||(h={}));var c=this.__extends||function(k,j){for(var l in j){if(j.hasOwnProperty(l)){k[l]=j[l]}}function i(){this.constructor=k}i.prototype=j.prototype;k.prototype=new i()};var h;(function(j){var i=(function(k){c(l,k);function l(m){k.call(this,m);j.Sanitizer.Require(m,{inputName:"Arguments",inputConstructor:Array},{inputName:"IsAnonymous",inputConstructor:Boolean},{inputName:"Type",inputConstructor:String});if(m.IsAnonymous){j.Sanitizer.Require(m,{inputName:"Members",inputConstructor:Array});if(m.Members.length!==m.Arguments.length){throw"If members are defined, each must have a corresponding argument"}}this.Arguments=linq(m.Arguments).Select(function(n){return j.Expression.CreateExpression(n)}).Result;this.Members=m.Members;this.Type=m.Type;this.IsAnonymous=m.IsAnonymous}l.prototype._Compile=function(){var m=this;var n=linq(this.Arguments).Select(function(o){return o.Compile()}).Result;return function(o){var p=linq(n).Select(function(q){return q(o)}).Result;if(m.IsAnonymous){return m.ConstructAnonymous(p)}else{if(l.RegisteredTypes[m.Type]){return l.Construct(l.RegisteredTypes[m.Type],p)}else{return{}}}}};l.prototype.ConstructAnonymous=function(p){var o={};for(var m=0,n=this.Members.length;m<n;m++){o[this.Members[m]]=p[m]}return o};l.Construct=function(n,m){var o=Object.create(n.prototype);var p=n.apply(o,m);return typeof p==="object"?p:o};l.RegisteredTypes={};return l})(j.Expression);j.NewExpression=i})(h||(h={}));var c=this.__extends||function(k,j){for(var l in j){if(j.hasOwnProperty(l)){k[l]=j[l]}}function i(){this.constructor=k}i.prototype=j.prototype;k.prototype=new i()};var h;(function(j){var i=(function(k){c(l,k);function l(m){k.call(this,m);j.Sanitizer.Require(m,{inputName:"Name",inputConstructor:String});this.Name=m.Name}l.prototype._Compile=function(){var m=this;return function(n){return n[m.Name]}};return l})(j.Expression);j.ParameterExpression=i})(h||(h={}));var h;(function(j){j.Initialize=function(k){};var i=(function(){function k(){}k.Require=function(o){var q=[];for(var l=0;l<(arguments.length-1);l++){q[l]=arguments[l+1]}if(o==null){throw"Item must have a value"}for(var m=0,n=q.length;m<n;m++){var p=q[m];if(p.allowNull&&o[p.inputName]==null){return}if(!p.allowNull&&o[p.inputName]==null){throw"Property "+p.inputName+" cannot be null"}if(p.inputType&&typeof o[p.inputName]!==p.inputType){throw"Property "+p.inputName+" must be of type "+p.inputType}if(p.inputConstructor&&o[p.inputName].constructor!==p.inputConstructor){throw {message:"Property "+p.inputName+" must be of a give type",type:p.inputConstructor}}}};return k})();j.Sanitizer=i})(h||(h={}));var c=this.__extends||function(k,j){for(var l in j){if(j.hasOwnProperty(l)){k[l]=j[l]}}function i(){this.constructor=k}i.prototype=j.prototype;k.prototype=new i()};var h;(function(j){var i=(function(k){c(l,k);function l(m){k.call(this,m);j.Sanitizer.Require(m,{inputName:"Operand",inputType:"object"});this.Operand=j.Expression.CreateExpression(m.Operand)}l.prototype._Compile=function(){var m=this;var n=this.Operand.Compile();return function(o){return l.OperatorDictionary[m.NodeType](n(o))}};l.OperatorDictionary=(function(){var m=[];m[j.Meta.ExpressionType.Convert]=function(n){return n};m[j.Meta.ExpressionType.Not]=function(n){return !n};return m})();l.OperatorStringDictionary=(function(){var m=[];m[j.Meta.ExpressionType.Convert]=function(n){return n};m[j.Meta.ExpressionType.Not]=function(n){return"!"+n};return m})();return l})(j.Expression);j.UnaryExpression=i})(h||(h={}));var e=(function(){function i(){}i.createExpression=h.Expression.CreateExpression;i.registeredConstructors=h.NewExpression.RegisteredTypes;i.registeredMethods=h.MethodCallExpression.RegisteredMethods;return i})();window.ex=e;window.WebExpressions=h})();(function(d){var e,f,g,i;var l=/^[\w\d_]+(,([\w\d_]+))*$/;var k=/^[\s\t\r\n]*\{.*\}[\s\t\r\n]*$/;var m=/[\s\t\r\n]/g;var c=function(n,o){return h(n).Union(o).Result};d.Linq=function(n){this.Result=h.utils.transformToArray(n)};d.linq=function(n){return new d.Linq(n?n:[])};var h=d.linq;h.utils={convertLambda:function(n){if(!n||n.constructor===Function){return n}else{if(n.constructor!==String){throw"Invalid linq function"}else{if(n.indexOf("=>")===-1){throw'"=>" expression not found'}}}var p=n.substring(n.indexOf("=>")+2);var o=n.substring(0,n.indexOf("=>")).replace(m,"");if(o.indexOf("(")===0){o=o.substring(1);if(o.indexOf(")")===o.length-1){o=o.substring(0,o.length-1)}else{throw"Invalid left hand side"}}if(o.length<1||!l.test(o)){throw"Invalid left hand side"}else{if(p.length<1){throw"Invalid right hand side"}}if(k.test(p)){return new Function(o,p)}else{return new Function(o,"return "+p+";")}},transformToArray:function(n){if(n.constructor===Array){return n}else{if(n.constructor===d.Linq){return n.Result}else{if(n.constructor===NodeList){return n}else{throw"Input must be array or Linq object"}}}},transformToLinq:function(n){if(n.constructor===d.Linq){return n}else{if(n.constructor===Array){return h(n)}else{throw"Input must be array or Linq object"}}}};h.fn=d.Linq.prototype;h.fn.Select=function(q){q=h.utils.convertLambda(q);var p=h();for(var n=0,o=this.Result.length;n<o;n++){p.Result[n]=q(this.Result[n])}return p};var j=function(o,p){p=h.utils.convertLambda(p);var n=function(r){return r!=null&&r.constructor===Number};var q=(p?o.Select(p):o).Where(n).Result;if(q.length===0){throw"Sequence contains no elements."}return q};h.fn.Max=function(n){return Math.max.apply(Math,j(this,n))};h.fn.Min=function(n){return Math.min.apply(Math,j(this,n))};h.fn.Aggregate=function(n){if(n===undefined){n=c}else{n=h.utils.convertLambda(n)}var q=h();for(var o=0,p=this.Result.length;o<p;o++){q.Result=n(q.Result,this.Result[o])}return q};h.fn.Union=function(n){n=h.utils.transformToArray(n);var r=h();var o;for(o=0,e=this.Result.length;o<e;o++){r.Result[o]=this.Result[o]}for(var p=0,q=n.length;p<q;p++){if(!r.Contains(n[p])){r.Result[o+p]=n[p]}else{o--}}return r};h.fn.Contains=function(n){for(var o=0,p=this.Result.length;o<p;o++){if(this.Result[o]===n){return true}}return false};h.fn.Any=function(p){if(!p){return this.Result.length>0}p=h.utils.convertLambda(p);for(var n=0,o=this.Result.length;n<o;n++){if(p(this.Result[n])){return true}}return false};h.fn.Where=function(r){r=h.utils.convertLambda(r);var q=0;var p=h();for(var n=0,o=this.Result.length;n<o;n++){if(r(this.Result[n])){p.Result[n-q]=this.Result[n]}else{q++}}return p};h.fn.First=function(p){if(!p){return this.Result[0]}else{p=h.utils.convertLambda(p);for(var n=0,o=this.Result.length;n<o;n++){if(p(this.Result[n])){return this.Result[n]}}}return null};h.fn.Last=function(o){if(!o){return this.Result[this.Result.length-1]}else{o=h.utils.convertLambda(o);for(var n=this.Result.length-1;n>=0;n--){if(o(this.Result[n])){return this.Result[n]}}}return null};h.fn.GroupBy=function(r){r=h.utils.convertLambda(r);var q=h();var p=null;var s=null;for(var n=0,o=this.Result.length;n<o;n++){p=r(this.Result[n]);s=q.Where(function(t){return t.key===p});if(s.Any()){s.Result[0].values.push(this.Result[n])}else{q.Result.push({key:p,values:[this.Result[n]]})}}return q};h.fn.OrderBy=function(s){s=h.utils.convertLambda(s);var n=new Object();var q=h();var w=[];var v=[];var u=null;for(var o=0,p=this.Result.length;o<p;o++){var r=s?s(this.Result[o]):this.Result[o];w[o]={key:o,value:r};v[o]={key:o,value:this.Result[o]};if(r&&u==null){u=typeof r==="number"?n:r.constructor}else{if(r&&u!==(typeof r==="number"?n:r.constructor)){throw"Invalid comparison type"}}}var t=function(x,y){if(x.value<y.value){return -1}else{if(x.value>y.value){return 1}else{return 0}}};w.sort(t);for(var o=0,p=w.length;o<p;o++){q.Result[o]=h(v).First(function(x){return x.key===w[o].key}).value}return q};h.fn.OrderByDecending=function(o){var n=this.OrderBy(h.utils.convertLambda(o));n.Result.reverse();return n};h.fn.Skip=function(q){var p=h();for(var n=q,o=this.Result.length;n<o;n++){p.Result[n-q]=this.Result[n]}return p};h.fn.Take=function(q){var p=h();var o=q<this.Result.length?q:this.Result.length;for(var n=0;n<o;n++){p.Result[n]=this.Result[n]}return p};h.fn.Distinct=function(){var q=0;var p=h();for(var n=0,o=this.Result.length;n<o;n++){if(!p.Contains(this.Result[n])){p.Result[n-q]=this.Result[n]}else{q++}}return p};h.fn.Each=function(p){p=h.utils.convertLambda(p);for(var n=0,o=this.Result.length;n<o;n++){p(this.Result[n],n)}return this};h.fn.ReverseEach=function(o){o=h.utils.convertLambda(o);for(var n=this.Result.length-1;n>=0;n--){o(this.Result[n],n)}return this}})(window);var b;(function(c){(function(e){var f=(function(){function g(i,h){this.Entity=h;this.Rules=linq(i||[]).Select(g.CreateRule).Result}g.CreateRule=function(i){var h=ex.createExpression(i.Expression).Compile();return{RequiredForValidation:linq(i.RequiredForValidation).Select(function(j){return g.MemberChainItemString(j,true)}).Result,ValidationSubjects:linq(i.ValidationSubjects).Select(function(j){return g.MemberChainItemString(j,true)}).Result,Validate:function(l,j){if(typeof j==="undefined"){j=false}var k={};k[i.EntityParameter]=l;k[i.ContextParameter]={Violations:[],BreakOnFirstError:j,Mocks:[],Dependencies:{}};h(k);return k[i.ContextParameter].Violations}}};g.MemberChainItemString=function(h,j){if(j){h=h.NextItem}var i=[];while(h){i.push(h.MemberName);h=h.NextItem}return i.join(".")};g.prototype.Validate=function(j,h){if(typeof h==="undefined"){h=false}var i=this.GetEntity();return linq(this.Rules).Where(function(k){return k.ValidationSubjects.indexOf(j)!==-1}).Select(function(k){return k.Validate(i,h)}).Aggregate().Where(function(k){return g.FilterViolation(k,j)}).Result};g.prototype.GetEntity=function(){throw"Invalid operation, this method is abstract"};g.FilterViolation=function(i,h){return linq(i.Violated).Any(function(j){return g.MemberChainItemString(j,true)===h})};return g})();e.Validator=f})(c.Validation||(c.Validation={}));var d=c.Validation})(b||(b={}));var b;(function(c){var d=(function(){function e(){}e.Bootstrap=function(){if(e._Initialized){return}e._Initialized=true;e._InitializeConstructors();e._InitializeMethods()};e._InitializeConstructors=function(){ex.registeredConstructors["BackToFront.Utilities.SimpleViolation"]=function(f){this.UserMessage=f}};e._InitializeMethods=function(){ex.registeredMethods["System.Collections.Generic.ICollection`1[[BackToFront.IViolation, BackToFront, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]].Add"]=function(f){if(!this||!this.push||this.push.constructor!==Function){throw"This method must be called on an array##"}this.push(f)};ex.registeredMethods["System.String.IsNullOrEmpty"]=function(f){return !f};ex.registeredMethods["System.String.IsNullOrWhiteSpace"]=function(f){return !f||!f.trim()}};e._Initialized=false;return e})();c.Initialize=d})(b||(b={}));b.Initialize.Bootstrap();var b;(function(c){var d=(function(){function e(){}e.Require=function(j){var l=[];for(var f=0;f<(arguments.length-1);f++){l[f]=arguments[f+1]}if(j==null){throw"Item must have a value"}for(var g=0,h=l.length;g<h;g++){var k=l[g];if(k.allowNull&&j[k.inputName]==null){return}if(!k.allowNull&&j[k.inputName]==null){throw"Property "+k.inputName+" cannot be null"}if(k.inputType&&typeof j[k.inputName]!==k.inputType){throw"Property "+k.inputName+" must be of type "+k.inputType}if(k.inputConstructor&&j[k.inputName].constructor!==k.inputConstructor){throw {message:"Property "+k.inputName+" must be of a give type",type:k.inputConstructor}}}};return e})();c.Sanitizer=d})(b||(b={}));var a=this.__extends||function(f,e){for(var g in e){if(e.hasOwnProperty(g)){f[g]=e[g]}}function c(){this.constructor=f}c.prototype=e.prototype;f.prototype=new c()};var b;(function(c){(function(g){var e=(function(){function h(i){if(typeof i==="undefined"){i=[]}this.Errors=i}return h})();g.JqueryBTFContext=e;var f=(function(h){a(i,h);function i(l,k,j){h.call(this,l,k);this.Context=j;i.Setup()}i.prototype.GetEntity=function(){var l={};var k=linq(this.Rules).Select(function(j){return linq(j.RequiredForValidation||[]).Union(j.ValidationSubjects||[]).Result}).Aggregate().Result;for(var n=0,o=k.length;n<o;n++){var m=jQuery('[name="'+k[n]+'"]',this.Context);if(m.attr("type")==="checkbox"){l[k[n]]=m.is(":checked")}else{l[k[n]]=m.val();if(m.attr("data-val-number")){if(!l[k[n]]){l[k[n]]=null}else{l[k[n]]=l[k[n]].indexOf(".")!==-1?parseFloat(l[k[n]]):parseInt(l[k[n]])}}}}return l};i.RegisterRule=function(j){c.Sanitizer.Require(j,{inputName:"Rules",inputConstructor:Array},{inputName:"Entity",inputConstructor:String});i.Registered.push(new i(j.Rules,j.Entity))};i.Setup=function(){if(!jQuery||!jQuery.validator){throw"This item requires jQuery and jQuery validation"}if(jQuery.validator.methods[i.ValidatorName]){return}jQuery.validator.addMethod(i.ValidatorName,i.Validate,i.HandlerErrors);if(jQuery.validator.unobtrusive&&jQuery.validator.unobtrusive.adapters){jQuery.validator.unobtrusive.adapters.add(i.ValidatorName,[],i.AddOptions)}};i.HandlerErrors=function(){if(this["__BTFContext"]&&this["__BTFContext"].Errors&&this["__BTFContext"].Errors.length){return i.JoinErrors(linq(this["__BTFContext"].Errors).Select(function(j){return j.UserMessage}).Result)}else{return undefined}};i.AddOptions=function(j){j.rules[i.ValidatorName]=j.params};i.Validate=function(n,k){var l=[];for(var j=0;j<(arguments.length-2);j++){l[j]=arguments[j+2]}var m=linq(i.Registered).Select(function(o){return o.Validate($(k).attr("name"),false)}).Aggregate();this["__BTFContext"]=new e(m.Result);return m.Result.length===0};i.JoinErrors=function(j){return j.join("<br />")};i.Registered=[];i.ValidatorName="backtofront";return i})(c.Validation.Validator);g.JQueryValidator=f})(c.Validation||(c.Validation={}));var d=c.Validation})(b||(b={}));window.__BTF=b})();