(function(){(function(){(function(g){var h,i,j,l;var o=/^[\w\d_]+(,([\w\d_]+))*$/;var n=/^[\s\t\r\n]*\{.*\}[\s\t\r\n]*$/;var p=/[\s\t\r\n]/g;var f=function(q,r){return k(q).Union(r).Result};g.Linq=function(q){this.Result=k.utils.transformToArray(q)};g.linq=function(q){return new g.Linq(q?q:[])};var k=g.linq;k.utils={convertLambda:function(q){if(!q||q.constructor===Function){return q}else{if(q.constructor!==String){throw"Invalid linq function"}else{if(q.indexOf("=>")===-1){throw'"=>" expression not found'}}}var s=q.substring(q.indexOf("=>")+2);var r=q.substring(0,q.indexOf("=>")).replace(p,"");if(r.indexOf("(")===0){r=r.substring(1);if(r.indexOf(")")===r.length-1){r=r.substring(0,r.length-1)}else{throw"Invalid left hand side"}}if(r.length<1||!o.test(r)){throw"Invalid left hand side"}else{if(s.length<1){throw"Invalid right hand side"}}if(n.test(s)){return new Function(r,s)}else{return new Function(r,"return "+s+";")}},transformToArray:function(q){if(q.constructor===Array){return q}else{if(q.constructor===g.Linq){return q.Result}else{if(q.constructor===NodeList){return q}else{throw"Input must be array or Linq object"}}}},transformToLinq:function(q){if(q.constructor===g.Linq){return q}else{if(q.constructor===Array){return k(q)}else{throw"Input must be array or Linq object"}}}};k.fn=g.Linq.prototype;k.fn.Select=function(t){t=k.utils.convertLambda(t);var s=k();for(var q=0,r=this.Result.length;q<r;q++){s.Result[q]=t(this.Result[q])}return s};var m=function(r,s){s=k.utils.convertLambda(s);var q=function(u){return u!=null&&u.constructor===Number};var t=(s?r.Select(s):r).Where(q).Result;if(t.length===0){throw"Sequence contains no elements."}return t};k.fn.Max=function(q){return Math.max.apply(Math,m(this,q))};k.fn.Min=function(q){return Math.min.apply(Math,m(this,q))};k.fn.Aggregate=function(q){if(q===undefined){q=f}else{q=k.utils.convertLambda(q)}var t=k();for(var r=0,s=this.Result.length;r<s;r++){t.Result=q(t.Result,this.Result[r])}return t};k.fn.Union=function(q){q=k.utils.transformToArray(q);var u=k();var r;for(r=0,h=this.Result.length;r<h;r++){u.Result[r]=this.Result[r]}for(var s=0,t=q.length;s<t;s++){if(!u.Contains(q[s])){u.Result[r+s]=q[s]}else{r--}}return u};k.fn.Contains=function(q){for(var r=0,s=this.Result.length;r<s;r++){if(this.Result[r]===q){return true}}return false};k.fn.Any=function(s){if(!s){return this.Result.length>0}s=k.utils.convertLambda(s);for(var q=0,r=this.Result.length;q<r;q++){if(s(this.Result[q])){return true}}return false};k.fn.Where=function(u){u=k.utils.convertLambda(u);var t=0;var s=k();for(var q=0,r=this.Result.length;q<r;q++){if(u(this.Result[q])){s.Result[q-t]=this.Result[q]}else{t++}}return s};k.fn.First=function(s){if(!s){return this.Result[0]}else{s=k.utils.convertLambda(s);for(var q=0,r=this.Result.length;q<r;q++){if(s(this.Result[q])){return this.Result[q]}}}return null};k.fn.Last=function(r){if(!r){return this.Result[this.Result.length-1]}else{r=k.utils.convertLambda(r);for(var q=this.Result.length-1;q>=0;q--){if(r(this.Result[q])){return this.Result[q]}}}return null};k.fn.GroupBy=function(u){u=k.utils.convertLambda(u);var t=k();var s=null;var v=null;for(var q=0,r=this.Result.length;q<r;q++){s=u(this.Result[q]);v=t.Where(function(w){return w.key===s});if(v.Any()){v.Result[0].values.push(this.Result[q])}else{t.Result.push({key:s,values:[this.Result[q]]})}}return t};k.fn.OrderBy=function(v){v=k.utils.convertLambda(v);var q=new Object();var t=k();var z=[];var y=[];var x=null;for(var r=0,s=this.Result.length;r<s;r++){var u=v?v(this.Result[r]):this.Result[r];z[r]={key:r,value:u};y[r]={key:r,value:this.Result[r]};if(u&&x==null){x=typeof u==="number"?q:u.constructor}else{if(u&&x!==(typeof u==="number"?q:u.constructor)){throw"Invalid comparison type"}}}var w=function(A,B){if(A.value<B.value){return -1}else{if(A.value>B.value){return 1}else{return 0}}};z.sort(w);for(var r=0,s=z.length;r<s;r++){t.Result[r]=k(y).First(function(A){return A.key===z[r].key}).value}return t};k.fn.OrderByDecending=function(r){var q=this.OrderBy(k.utils.convertLambda(r));q.Result.reverse();return q};k.fn.Skip=function(t){var s=k();for(var q=t,r=this.Result.length;q<r;q++){s.Result[q-t]=this.Result[q]}return s};k.fn.Take=function(t){var s=k();var r=t<this.Result.length?t:this.Result.length;for(var q=0;q<r;q++){s.Result[q]=this.Result[q]}return s};k.fn.Distinct=function(){var t=0;var s=k();for(var q=0,r=this.Result.length;q<r;q++){if(!s.Contains(this.Result[q])){s.Result[q-t]=this.Result[q]}else{t++}}return s};k.fn.Each=function(s){s=k.utils.convertLambda(s);for(var q=0,r=this.Result.length;q<r;q++){s(this.Result[q],q)}return this};k.fn.ReverseEach=function(r){r=k.utils.convertLambda(r);for(var q=this.Result.length-1;q>=0;q--){r(this.Result[q],q)}return this}})(window);var e;(function(g){(function(j){var i=(function(){function k(l,m){this.Key=l;this.Value=m}return k})();var h=(function(){function k(){this._InnerDictionary=[]}k.prototype.ContainsKey=function(l){return linq(this._InnerDictionary).Any(function(m){return m.Key===l})};k.prototype.Add=function(l,m){if(this.ContainsKey(l)){throw"Dictionary alredy contains the key "+l}this._InnerDictionary.push(new i(l,m))};k.prototype.AddOrReplace=function(m,n){var l=linq(this._InnerDictionary).First(function(o){return o.Key===m});if(l){l.Value=n}else{this._InnerDictionary.push(new i(m,n))}};k.prototype.Value=function(m){var l=linq(this._InnerDictionary).First(function(n){return n.Key===m});return l?l.Value:null};k.prototype.Remove=function(n){for(var l=0,m=this._InnerDictionary.length;l<m;l++){if(this._InnerDictionary[l].Key===n){this._InnerDictionary.splice(l,1);return true}}return false};k.prototype.Merge=function(l){if(l){for(var m=0,n=l._InnerDictionary.length;m<n;m++){var o=l._InnerDictionary[m];this.Add(o.Key,o.Value)}}return this};return k})();j.Dictionary=h})(g.Utils||(g.Utils={}));var f=g.Utils})(e||(e={}));var e;(function(g){(function(j){(function(k){k._map=[];k.Binary=1;k.Constant=2;k.Member=3;k.MethodCall=4;k.Parameter=5;k.Unary=6;k.Default=7;k.Block=8;k.Conditional=9;k.Invocation=10;k.New=11})(j.ExpressionWrapperType||(j.ExpressionWrapperType={}));var i=j.ExpressionWrapperType;(function(k){k._map=[];k.Add=0;k.AddChecked=1;k.And=2;k.AndAlso=3;k.ArrayLength=4;k.ArrayIndex=5;k.Call=6;k.Coalesce=7;k.Conditional=8;k.Constant=9;k.Convert=10;k.ConvertChecked=11;k.Divide=12;k.Equal=13;k.ExclusiveOr=14;k.GreaterThan=15;k.GreaterThanOrEqual=16;k.Invoke=17;k.Lambda=18;k.LeftShift=19;k.LessThan=20;k.LessThanOrEqual=21;k.ListInit=22;k.MemberAccess=23;k.MemberInit=24;k.Modulo=25;k.Multiply=26;k.MultiplyChecked=27;k.Negate=28;k.UnaryPlus=29;k.NegateChecked=30;k.New=31;k.NewArrayInit=32;k.NewArrayBounds=33;k.Not=34;k.NotEqual=35;k.Or=36;k.OrElse=37;k.Parameter=38;k.Power=39;k.Quote=40;k.RightShift=41;k.Subtract=42;k.SubtractChecked=43;k.TypeAs=44;k.TypeIs=45;k.Assign=46;k.Block=47;k.DebugInfo=48;k.Decrement=49;k.Dynamic=50;k.Default=51;k.Extension=52;k.Goto=53;k.Increment=54;k.Index=55;k.Label=56;k.RuntimeVariables=57;k.Loop=58;k.Switch=59;k.Throw=60;k.Try=61;k.Unbox=62;k.AddAssign=63;k.AndAssign=64;k.DivideAssign=65;k.ExclusiveOrAssign=66;k.LeftShiftAssign=67;k.ModuloAssign=68;k.MultiplyAssign=69;k.OrAssign=70;k.PowerAssign=71;k.RightShiftAssign=72;k.SubtractAssign=73;k.AddAssignChecked=74;k.MultiplyAssignChecked=75;k.SubtractAssignChecked=76;k.PreIncrementAssign=77;k.PreDecrementAssign=78;k.PostIncrementAssign=79;k.PostDecrementAssign=80;k.TypeEqual=81;k.OnesComplement=82;k.IsTrue=83;k.IsFalse=84})(j.ExpressionType||(j.ExpressionType={}));var h=j.ExpressionType})(g.Meta||(g.Meta={}));var f=g.Meta})(e||(e={}));var e;(function(g){var f=(function(){function i(j){g.Sanitizer.Require(j,{inputName:"NodeType",inputConstructor:Number},{inputName:"ExpressionType",inputConstructor:Number});this.NodeType=j.NodeType;this.ExpressionType=j.ExpressionType}i.prototype.Compile=function(){if(!this._Compiled){this._Compiled=this._Compile()}return this._Compiled};i.prototype.EvalCompile=function(){if(!this._EvalCompiled){var k=this.EvalExpression();var j=new Function(g.ConstantExpression.ConstantParameter,k.Expression);this._EvalCompiled=function(){return j(k.Constants)}}return this._EvalCompiled};i.prototype._Compile=function(){throw"Invalid operation"};i.prototype.EvalExpression=function(){throw"Invalid operation"};i.prototype.GetAffectedProperties=function(){return[]};i.ExpressionConstructorDictionary=(function(){var j={};j[g.Meta.ExpressionWrapperType.Binary]=function(k){return new g.BinaryExpression(k)};j[g.Meta.ExpressionWrapperType.Block]=function(k){return new g.BlockExpression(k)};j[g.Meta.ExpressionWrapperType.Conditional]=function(k){return new g.ConditionalExpression(k)};j[g.Meta.ExpressionWrapperType.Constant]=function(k){return new g.ConstantExpression(k)};j[g.Meta.ExpressionWrapperType.Default]=function(k){return new g.DefaultExpression(k)};j[g.Meta.ExpressionWrapperType.Member]=function(k){return new g.MemberExpression(k)};j[g.Meta.ExpressionWrapperType.MethodCall]=function(k){return new g.MethodCallExpression(k)};j[g.Meta.ExpressionWrapperType.Parameter]=function(k){return new g.ParameterExpression(k)};j[g.Meta.ExpressionWrapperType.Unary]=function(k){return new g.UnaryExpression(k)};j[g.Meta.ExpressionWrapperType.Invocation]=function(k){return new g.InvocationExpression(k)};j[g.Meta.ExpressionWrapperType.New]=function(k){return new g.NewExpression(k)};return j})();i.CreateExpression=function h(j){if(j.NodeType===g.Meta.ExpressionType.Assign&&j.ExpressionType===g.Meta.ExpressionWrapperType.Binary){return new g.AssignmentExpression(j)}if(i.ExpressionConstructorDictionary[j.ExpressionType]){return i.ExpressionConstructorDictionary[j.ExpressionType](j)}throw"Invalid expression type"};return i})();g.Expression=f})(e||(e={}));var c=this.__extends||function(h,g){function f(){this.constructor=h}f.prototype=g.prototype;h.prototype=new f()};var e;(function(g){var f=(function(h){c(i,h);function i(j){h.call(this,j);g.Sanitizer.Require(j,{inputName:"Left",inputType:"object"},{inputName:"Right",inputType:"object"});switch(j.Left.ExpressionType){case g.Meta.ExpressionWrapperType.Parameter:this.Left=null;this.LeftProperty=(j.Left).Name;break;case g.Meta.ExpressionWrapperType.Member:this.Left=g.Expression.CreateExpression((j.Left).Expression);this.LeftProperty=(j.Left).MemberName;break;default:throw"The left hand side of an assignment must be a parameter or a member"}this.Right=g.Expression.CreateExpression(j.Right)}i.prototype.EvalExpression=function(){var k=this.Right.EvalExpression();var j=this.Left?this.Left.EvalExpression():null;if(j){k.Constants.Merge(j.Constants)}return{Expression:"("+(j?j.Expression+".":"")+this.LeftProperty+" = "+k.Expression+")",Constants:k.Constants}};i.prototype._Compile=function(){var j=this;var k=this.Left?this.Left.Compile():function(m){return m};var l=this.Right.Compile();return function(m){return k(m)[j.LeftProperty]=l(m)}};return i})(g.Expression);g.AssignmentExpression=f})(e||(e={}));var c=this.__extends||function(h,g){function f(){this.constructor=h}f.prototype=g.prototype;h.prototype=new f()};var e;(function(h){var g=h.Meta;var f=(function(i){c(j,i);function j(k){i.call(this,k);if(!j.OperatorDictionary[this.NodeType]){throw"##Invalid Operator"}h.Sanitizer.Require(k,{inputName:"Left",inputType:"object"},{inputName:"Right",inputType:"object"});this.Left=h.Expression.CreateExpression(k.Left);this.Right=h.Expression.CreateExpression(k.Right)}j.OperatorDictionary=(function(){var k=[];k[h.Meta.ExpressionType.Add]=function(l,m){return l+m};k[h.Meta.ExpressionType.AndAlso]=function(l,m){return l&&m};k[h.Meta.ExpressionType.Divide]=function(l,m){return l/m};k[h.Meta.ExpressionType.Equal]=function(l,m){return l===m};k[h.Meta.ExpressionType.GreaterThan]=function(l,m){return l>m};k[h.Meta.ExpressionType.GreaterThanOrEqual]=function(l,m){return l>=m};k[h.Meta.ExpressionType.LessThan]=function(l,m){return l<m};k[h.Meta.ExpressionType.LessThanOrEqual]=function(l,m){return l<=m};k[h.Meta.ExpressionType.Multiply]=function(l,m){return l*m};k[h.Meta.ExpressionType.NotEqual]=function(l,m){return l!==m};k[h.Meta.ExpressionType.OrElse]=function(l,m){return l||m};k[h.Meta.ExpressionType.Subtract]=function(l,m){return l-m};return k})();j.OperatorStringDictionary=(function(){var k=[];k[h.Meta.ExpressionType.Add]=" + ";k[h.Meta.ExpressionType.AndAlso]=" && ";k[h.Meta.ExpressionType.Divide]=" / ";k[h.Meta.ExpressionType.Equal]=" === ";k[h.Meta.ExpressionType.GreaterThan]=" > ";k[h.Meta.ExpressionType.GreaterThanOrEqual]=" >= ";k[h.Meta.ExpressionType.LessThan]=" < ";k[h.Meta.ExpressionType.LessThanOrEqual]=" <= ";k[h.Meta.ExpressionType.Multiply]=" * ";k[h.Meta.ExpressionType.NotEqual]=" !== ";k[h.Meta.ExpressionType.OrElse]=" || ";k[h.Meta.ExpressionType.Subtract]=" - ";return k})();j.prototype.EvalExpression=function(){if(!j.OperatorStringDictionary[this.NodeType]){throw"Invalid expression type"}var k=this.Left.EvalExpression();var l=this.Right.EvalExpression();return{Expression:"("+k.Expression+j.OperatorStringDictionary[this.NodeType]+l.Expression+")",Constants:k.Constants.Merge(l.Constants)}};j.prototype._Compile=function(){var k=this;if(!j.OperatorStringDictionary[this.NodeType]){throw"Invalid expression type"}var l=this.Left.Compile();var m=this.Right.Compile();return function(n){return j.OperatorDictionary[k.NodeType](l(n),m(n))}};return j})(h.Expression);h.BinaryExpression=f})(e||(e={}));var c=this.__extends||function(h,g){function f(){this.constructor=h}f.prototype=g.prototype;h.prototype=new f()};var e;(function(g){var f=(function(h){c(i,h);function i(j){h.call(this,j);g.Sanitizer.Require(j,{inputName:"Expressions",inputConstructor:Array});this.Expressions=linq(j.Expressions).Select(function(k){return g.Expression.CreateExpression(k)}).Result}i.prototype.EvalExpression=function(){var j=linq(this.Expressions).Select(function(m){return m.EvalExpression()}).Result;if(!j.length){return{Constants:new g.Utils.Dictionary(),Expression:""}}for(var k=1,l=j.length;k<l;k++){j[0].Constants.Merge(j[k].Constants)}return{Expression:linq(j).Select(function(m){return m.Expression}).Result.join(";\n"),Constants:j[0].Constants}};i.prototype._Compile=function(){var j=linq(this.Expressions).Select(function(k){return k.Compile()}).Result;return function(k){return linq(j).Each(function(l){return l(k)})}};return i})(g.Expression);g.BlockExpression=f})(e||(e={}));var c=this.__extends||function(h,g){function f(){this.constructor=h}f.prototype=g.prototype;h.prototype=new f()};var e;(function(g){var f=(function(h){c(i,h);function i(j){h.call(this,j);g.Sanitizer.Require(j,{inputName:"IfTrue",inputType:"object"},{inputName:"IfFalse",inputType:"object"},{inputName:"Test",inputType:"object"});this.IfTrue=g.Expression.CreateExpression(j.IfTrue);this.IfFalse=g.Expression.CreateExpression(j.IfFalse);this.Test=g.Expression.CreateExpression(j.Test)}i.prototype.EvalExpression=function(){if(this.IfTrue.ExpressionType===g.Meta.ExpressionWrapperType.Block||this.IfFalse.ExpressionType===g.Meta.ExpressionWrapperType.Block){return this._ToBlockString()}return this._ToInlineString()};i.prototype._ToInlineString=function(){var l=this.Test.EvalExpression();var k=this.IfTrue.EvalExpression();var j=this.IfFalse.EvalExpression();return{Constants:l.Constants.Merge(k.Constants).Merge(j.Constants),Expression:"("+l.Expression+" ? "+k.Expression+" : "+j.Expression+")"}};i.prototype._ToBlockString=function(){var l=this.Test.EvalExpression();var k=this.IfTrue.EvalExpression();var j=this.IfFalse.EvalExpression();return{Constants:l.Constants.Merge(k.Constants).Merge(j.Constants),Expression:"if("+l.Expression+") { "+k.Expression+" } else { "+j.Expression+" }"}};i.prototype._Compile=function(){var l=this.Test.Compile();var k=this.IfTrue.Compile();var j=this.IfFalse.Compile();return function(m){return l(m)?k(m):j(m)}};return i})(g.Expression);g.ConditionalExpression=f})(e||(e={}));var c=this.__extends||function(h,g){function f(){this.constructor=h}f.prototype=g.prototype;h.prototype=new f()};var e;(function(g){var f=(function(h){c(i,h);function i(j){h.call(this,j);this.Value=j.Value}i.ConstantParameter="__constants";i.GenerateConstantId=(function(){var j=0;return function(){return"constant-"+(++j)}})();i.prototype.EvalExpression=function(){var j=i.GenerateConstantId();var k=new g.Utils.Dictionary();k.Add(j,this.Value);return{Constants:k,Expression:i.ConstantParameter+"["+j+"]"}};i.prototype._Compile=function(){var j=this;return function(k){return j.Value}};return i})(g.Expression);g.ConstantExpression=f})(e||(e={}));var c=this.__extends||function(h,g){function f(){this.constructor=h}f.prototype=g.prototype;h.prototype=new f()};var e;(function(g){var f=(function(h){c(i,h);function i(j){h.call(this,j)}i.prototype.EvalExpression=function(){return{Expression:"",Constants:new g.Utils.Dictionary()}};i.prototype._Compile=function(){return function(j){return null}};return i})(g.Expression);g.DefaultExpression=f})(e||(e={}));var c=this.__extends||function(h,g){function f(){this.constructor=h}f.prototype=g.prototype;h.prototype=new f()};var e;(function(g){var f=(function(h){c(i,h);function i(j){h.call(this,j);g.Sanitizer.Require(j,{inputName:"Expression",inputType:"object"},{inputName:"Arguments",inputConstructor:Array});this.Expression=g.Expression.CreateExpression(j.Expression);this.Arguments=linq(j.Arguments).Select(function(k){return g.Expression.CreateExpression(k)}).Result}i.prototype.EvalExpression=function(){var k=this.Expression.EvalExpression();var j=linq(this.Arguments).Select(function(l){return l.EvalExpression()});linq(j).Each(function(l){return k.Constants.Merge(l.Constants)});return{Constants:k.Constants,Expression:k.Expression+"("+linq(j).Select(function(l){return l.Expression}).Result.join(", ")+")"}};i.prototype._Compile=function(){var k=this.Expression.Compile();var j=linq(this.Arguments).Select(function(l){return l.Compile()}).Result;return function(l){var m=k(l);var n=linq(j).Select(function(o){return o(l)}).Result;return m.apply(l,n)}};return i})(g.Expression);g.InvocationExpression=f})(e||(e={}));var c=this.__extends||function(h,g){function f(){this.constructor=h}f.prototype=g.prototype;h.prototype=new f()};var e;(function(g){var f=(function(h){c(i,h);function i(j){h.call(this,j);g.Sanitizer.Require(j,{inputName:"Expression",inputType:"object",allowNull:true},{inputName:"MemberName",inputConstructor:String});this.Expression=j.Expression?g.Expression.CreateExpression(j.Expression):null;this.MemberName=j.MemberName}i.PropertyRegex=new RegExp("^[a-zA-Z][a-zA-Z0-9]*$");i.prototype.EvalExpression=function(){throw"Not implemented, need to split into static and non static member references";if(!i.PropertyRegex.test(this.MemberName)){throw"Invalid property name: "+this.MemberName}var j=this.Expression.EvalExpression();return{Expression:j.Expression+"."+this.MemberName,Constants:j.Constants}};i.prototype._Compile=function(){if(!i.PropertyRegex.test(this.MemberName)){throw"Invalid property name: "+this.MemberName}if(this.Expression){var k=this.MemberName;var j=this.Expression.Compile();return function(l){return j(l)[k]}}else{throw"Not implemented exception"}};return i})(g.Expression);g.MemberExpression=f})(e||(e={}));var c=this.__extends||function(h,g){function f(){this.constructor=h}f.prototype=g.prototype;h.prototype=new f()};var e;(function(g){var f=(function(h){c(i,h);function i(j){h.call(this,j);g.Sanitizer.Require(j,{inputName:"Object",inputType:"object",allowNull:true},{inputName:"Arguments",inputConstructor:Array},{inputName:"MethodName",inputConstructor:String},{inputName:"MethodFullName",inputConstructor:String});this.Object=j.Object?g.Expression.CreateExpression(j.Object):null;this.Arguments=linq(j.Arguments).Select(function(k){return g.Expression.CreateExpression(k)}).Result;this.MethodName=j.MethodName;this.MethodFullName=j.MethodFullName}i.prototype.EvalExpression=function(){throw"Not implemented, need to split into static and non static method calls";if(!g.MemberExpression.PropertyRegex.test(this.MethodName)){throw"Invalid method name: "+this.MethodName}var j=linq(this.Arguments).Select(function(m){return m.EvalExpression()}).Result;var l=this.Object.EvalExpression();linq(j).Each(function(m){return l.Constants.Merge(m.Constants)});var k='__o["'+this.MethodName+'"]';return{Expression:"(function (__o) { return ("+k+" ? "+k+' : ex.ns.MethodCallExpression.RegisteredMethods["'+this.MethodFullName+'"]).call(__o, '+j.join(", ")+"); })("+l.Expression+")",Constants:l.Constants}};i.prototype._Compile=function(){var j=this;if(!g.MemberExpression.PropertyRegex.test(this.MethodName)){throw"Invalid method name: "+this.MethodName}var l=this.Object?this.Object.Compile():function(m){return window};var k=linq(this.Arguments).Select(function(m){return m.Compile()}).Result;return function(m){var n=l(m);var p=linq(k).Select(function(o){return o(m)}).Result;return(n[j.MethodName]?n[j.MethodName]:i.RegisteredMethods[j.MethodFullName]).apply(n,p)}};i.RegisteredMethods={};return i})(g.Expression);g.MethodCallExpression=f})(e||(e={}));var c=this.__extends||function(h,g){function f(){this.constructor=h}f.prototype=g.prototype;h.prototype=new f()};var e;(function(g){var f=(function(h){c(j,h);function j(k){h.call(this,k);g.Sanitizer.Require(k,{inputName:"Arguments",inputConstructor:Array},{inputName:"IsAnonymous",inputConstructor:Boolean},{inputName:"Type",inputConstructor:String});if(k.IsAnonymous){g.Sanitizer.Require(k,{inputName:"Members",inputConstructor:Array});if(k.Members.length!==k.Arguments.length){throw"If members are defined, each must have a corresponding argument"}}this.Arguments=linq(k.Arguments).Select(function(l){return g.Expression.CreateExpression(l)}).Result;this.Members=k.Members;this.Type=k.Type;this.IsAnonymous=k.IsAnonymous}j.prototype.EvalExpression=function(){var k=linq(this.Arguments).Select(function(n){return n.EvalExpression()}).Result;var m=new g.Utils.Dictionary();linq(k).Each(function(n){return m.Merge(n.Constants)});var l=linq(k).Select(function(n){return n.Expression}).Result.join(", ");if(this.IsAnonymous){return{Constants:m,Expression:"{ "+l+" }"}}else{if(j.RegisteredTypes[this.Type]){return{Constants:m,Expression:'new ex.ns.NewExpression.RegisteredTypes["'+this.Type+'"]('+l+")"}}else{return{Constants:m,Expression:"{}"}}}};j.prototype._Compile=function(){var k=this;var l=linq(this.Arguments).Select(function(m){return m.Compile()}).Result;return function(m){var n=linq(l).Select(function(o){return o(m)}).Result;if(k.IsAnonymous){return k.ConstructAnonymous(n)}else{if(j.RegisteredTypes[k.Type]){return j.Construct(j.RegisteredTypes[k.Type],n)}else{return{}}}}};j.prototype.ConstructAnonymous=function(n){var m={};for(var k=0,l=this.Members.length;k<l;k++){m[this.Members[k]]=n[k]}return m};j.Construct=function i(l,k){var m=Object.create(l.prototype);var n=l.apply(m,k);return typeof n==="object"?n:m};j.RegisteredTypes={};return j})(g.Expression);g.NewExpression=f})(e||(e={}));var c=this.__extends||function(h,g){function f(){this.constructor=h}f.prototype=g.prototype;h.prototype=new f()};var e;(function(g){var f=(function(h){c(i,h);function i(j){h.call(this,j);g.Sanitizer.Require(j,{inputName:"Name",inputConstructor:String});this.Name=j.Name}i.prototype.EvalExpression=function(){return{Expression:this.Name,Constants:new g.Utils.Dictionary()}};i.prototype._Compile=function(){var j=this;return function(k){return k[j.Name]}};return i})(g.Expression);g.ParameterExpression=f})(e||(e={}));var e;(function(g){g.Initialize=function(h){};var f=(function(){function i(){}i.Require=function h(m){var o=[];for(var j=0;j<(arguments.length-1);j++){o[j]=arguments[j+1]}if(m==null){throw"Item must have a value"}for(var k=0,l=o.length;k<l;k++){var n=o[k];if(n.allowNull&&m[n.inputName]==null){return}if(!n.allowNull&&m[n.inputName]==null){throw"Property "+n.inputName+" cannot be null"}if(n.inputType&&typeof m[n.inputName]!==n.inputType){throw"Property "+n.inputName+" must be of type "+n.inputType}if(n.inputConstructor&&m[n.inputName].constructor!==n.inputConstructor){throw {message:"Property "+n.inputName+" must be of a give type",type:n.inputConstructor}}}};return i})();g.Sanitizer=f})(e||(e={}));var c=this.__extends||function(h,g){function f(){this.constructor=h}f.prototype=g.prototype;h.prototype=new f()};var e;(function(g){var f=(function(h){c(i,h);function i(j){h.call(this,j);g.Sanitizer.Require(j,{inputName:"Operand",inputType:"object"});this.Operand=g.Expression.CreateExpression(j.Operand)}i.OperatorDictionary=(function(){var j=[];j[g.Meta.ExpressionType.Convert]=function(k){return k};j[g.Meta.ExpressionType.Not]=function(k){return !k};return j})();i.OperatorStringDictionary=(function(){var j=[];j[g.Meta.ExpressionType.Convert]=function(k){return k};j[g.Meta.ExpressionType.Not]=function(k){return"!"+k};return j})();i.prototype.EvalExpression=function(){var j=this.Operand.EvalExpression();return{Expression:"("+i.OperatorStringDictionary[this.NodeType](j.Expression)+")",Constants:j.Constants}};i.prototype._Compile=function(){var j=this;var k=this.Operand.Compile();return function(l){return i.OperatorDictionary[j.NodeType](k(l))}};return i})(g.Expression);g.UnaryExpression=f})(e||(e={}));var d=(function(){function f(){}f.createExpression=e.Expression.CreateExpression;f.registeredConstructors=e.NewExpression.RegisteredTypes;f.registeredMethods=e.MethodCallExpression.RegisteredMethods;return f})();window.ex=d;window.WebExpressions=e})();(function(d){var e,f,g,i;var l=/^[\w\d_]+(,([\w\d_]+))*$/;var k=/^[\s\t\r\n]*\{.*\}[\s\t\r\n]*$/;var m=/[\s\t\r\n]/g;var c=function(n,o){return h(n).Union(o).Result};d.Linq=function(n){this.Result=h.utils.transformToArray(n)};d.linq=function(n){return new d.Linq(n?n:[])};var h=d.linq;h.utils={convertLambda:function(n){if(!n||n.constructor===Function){return n}else{if(n.constructor!==String){throw"Invalid linq function"}else{if(n.indexOf("=>")===-1){throw'"=>" expression not found'}}}var p=n.substring(n.indexOf("=>")+2);var o=n.substring(0,n.indexOf("=>")).replace(m,"");if(o.indexOf("(")===0){o=o.substring(1);if(o.indexOf(")")===o.length-1){o=o.substring(0,o.length-1)}else{throw"Invalid left hand side"}}if(o.length<1||!l.test(o)){throw"Invalid left hand side"}else{if(p.length<1){throw"Invalid right hand side"}}if(k.test(p)){return new Function(o,p)}else{return new Function(o,"return "+p+";")}},transformToArray:function(n){if(n.constructor===Array){return n}else{if(n.constructor===d.Linq){return n.Result}else{if(n.constructor===NodeList){return n}else{throw"Input must be array or Linq object"}}}},transformToLinq:function(n){if(n.constructor===d.Linq){return n}else{if(n.constructor===Array){return h(n)}else{throw"Input must be array or Linq object"}}}};h.fn=d.Linq.prototype;h.fn.Select=function(q){q=h.utils.convertLambda(q);var p=h();for(var n=0,o=this.Result.length;n<o;n++){p.Result[n]=q(this.Result[n])}return p};var j=function(o,p){p=h.utils.convertLambda(p);var n=function(r){return r!=null&&r.constructor===Number};var q=(p?o.Select(p):o).Where(n).Result;if(q.length===0){throw"Sequence contains no elements."}return q};h.fn.Max=function(n){return Math.max.apply(Math,j(this,n))};h.fn.Min=function(n){return Math.min.apply(Math,j(this,n))};h.fn.Aggregate=function(n){if(n===undefined){n=c}else{n=h.utils.convertLambda(n)}var q=h();for(var o=0,p=this.Result.length;o<p;o++){q.Result=n(q.Result,this.Result[o])}return q};h.fn.Union=function(n){n=h.utils.transformToArray(n);var r=h();var o;for(o=0,e=this.Result.length;o<e;o++){r.Result[o]=this.Result[o]}for(var p=0,q=n.length;p<q;p++){if(!r.Contains(n[p])){r.Result[o+p]=n[p]}else{o--}}return r};h.fn.Contains=function(n){for(var o=0,p=this.Result.length;o<p;o++){if(this.Result[o]===n){return true}}return false};h.fn.Any=function(p){if(!p){return this.Result.length>0}p=h.utils.convertLambda(p);for(var n=0,o=this.Result.length;n<o;n++){if(p(this.Result[n])){return true}}return false};h.fn.Where=function(r){r=h.utils.convertLambda(r);var q=0;var p=h();for(var n=0,o=this.Result.length;n<o;n++){if(r(this.Result[n])){p.Result[n-q]=this.Result[n]}else{q++}}return p};h.fn.First=function(p){if(!p){return this.Result[0]}else{p=h.utils.convertLambda(p);for(var n=0,o=this.Result.length;n<o;n++){if(p(this.Result[n])){return this.Result[n]}}}return null};h.fn.Last=function(o){if(!o){return this.Result[this.Result.length-1]}else{o=h.utils.convertLambda(o);for(var n=this.Result.length-1;n>=0;n--){if(o(this.Result[n])){return this.Result[n]}}}return null};h.fn.GroupBy=function(r){r=h.utils.convertLambda(r);var q=h();var p=null;var s=null;for(var n=0,o=this.Result.length;n<o;n++){p=r(this.Result[n]);s=q.Where(function(t){return t.key===p});if(s.Any()){s.Result[0].values.push(this.Result[n])}else{q.Result.push({key:p,values:[this.Result[n]]})}}return q};h.fn.OrderBy=function(s){s=h.utils.convertLambda(s);var n=new Object();var q=h();var w=[];var v=[];var u=null;for(var o=0,p=this.Result.length;o<p;o++){var r=s?s(this.Result[o]):this.Result[o];w[o]={key:o,value:r};v[o]={key:o,value:this.Result[o]};if(r&&u==null){u=typeof r==="number"?n:r.constructor}else{if(r&&u!==(typeof r==="number"?n:r.constructor)){throw"Invalid comparison type"}}}var t=function(x,y){if(x.value<y.value){return -1}else{if(x.value>y.value){return 1}else{return 0}}};w.sort(t);for(var o=0,p=w.length;o<p;o++){q.Result[o]=h(v).First(function(x){return x.key===w[o].key}).value}return q};h.fn.OrderByDecending=function(o){var n=this.OrderBy(h.utils.convertLambda(o));n.Result.reverse();return n};h.fn.Skip=function(q){var p=h();for(var n=q,o=this.Result.length;n<o;n++){p.Result[n-q]=this.Result[n]}return p};h.fn.Take=function(q){var p=h();var o=q<this.Result.length?q:this.Result.length;for(var n=0;n<o;n++){p.Result[n]=this.Result[n]}return p};h.fn.Distinct=function(){var q=0;var p=h();for(var n=0,o=this.Result.length;n<o;n++){if(!p.Contains(this.Result[n])){p.Result[n-q]=this.Result[n]}else{q++}}return p};h.fn.Each=function(p){p=h.utils.convertLambda(p);for(var n=0,o=this.Result.length;n<o;n++){p(this.Result[n],n)}return this};h.fn.ReverseEach=function(o){o=h.utils.convertLambda(o);for(var n=this.Result.length-1;n>=0;n--){o(this.Result[n],n)}return this}})(window);var b;(function(c){})(b||(b={}));var b;(function(c){(function(e){var f=(function(){function i(k,j){this.Entity=j;this.Rules=linq(k||[]).Select(i.CreateRule).Result}i.CreateRule=function g(k){var j=ex.createExpression(k.Expression).Compile();return{RequiredForValidation:linq(k.RequiredForValidation).Select(function(l){return i.MemberChainItemString(l,true)}).Result,ValidationSubjects:linq(k.ValidationSubjects).Select(function(l){return i.MemberChainItemString(l,true)}).Result,Validate:function(n,l){if(typeof l==="undefined"){l=false}var m={};m[k.EntityParameter]=n;m[k.ContextParameter]={Violations:[],BreakOnFirstError:l,Mocks:[],Dependencies:{}};j(m);return m[k.ContextParameter].Violations}}};i.MemberChainItemString=function h(j,l){if(l){j=j.NextItem}var k=[];while(j){k.push(j.MemberName);j=j.NextItem}return k.join(".")};i.prototype.Validate=function(m,j){if(typeof j==="undefined"){j=false}var l=this.GetEntity();try{return linq(this.Rules).Where(function(n){return n.ValidationSubjects.indexOf(m)!==-1}).Select(function(n){return n.Validate(l,j)}).Aggregate().Result}catch(k){}};i.prototype.GetEntity=function(){throw"Invalid operation, this method is abstract"};return i})();e.Validator=f})(c.Validation||(c.Validation={}));var d=c.Validation})(b||(b={}));var b;(function(c){var d=(function(){function h(){}h._Initialized=false;h.Bootstrap=function g(){if(h._Initialized){return}h._Initialized=true;h._InitializeConstructors();h._InitializeMethods()};h._InitializeConstructors=function e(){ex.registeredConstructors["BackToFront.Utilities.SimpleViolation"]=function(i){this.UserMessage=i}};h._InitializeMethods=function f(){ex.registeredMethods["System.Collections.Generic.ICollection`1[[BackToFront.IViolation, BackToFront, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]].Add"]=function(i){if(!this||!this.push||this.push.constructor!==Function){throw"This method must be called on an array##"}this.push(i)};ex.registeredMethods["System.String.IsNullOrEmpty"]=function(i){return !i};ex.registeredMethods["System.String.IsNullOrWhiteSpace"]=function(i){return !i||!i.trim()}};return h})();c.Initialize=d})(b||(b={}));b.Initialize.Bootstrap();var b;(function(c){var d=(function(){function f(){}f.Require=function e(k){var m=[];for(var g=0;g<(arguments.length-1);g++){m[g]=arguments[g+1]}if(k==null){throw"Item must have a value"}for(var h=0,j=m.length;h<j;h++){var l=m[h];if(l.allowNull&&k[l.inputName]==null){return}if(!l.allowNull&&k[l.inputName]==null){throw"Property "+l.inputName+" cannot be null"}if(l.inputType&&typeof k[l.inputName]!==l.inputType){throw"Property "+l.inputName+" must be of type "+l.inputType}if(l.inputConstructor&&k[l.inputName].constructor!==l.inputConstructor){throw {message:"Property "+l.inputName+" must be of a give type",type:l.inputConstructor}}}};return f})();c.Sanitizer=d})(b||(b={}));var a=this.__extends||function(f,e){function c(){this.constructor=f}c.prototype=e.prototype;f.prototype=new c()};var b;(function(c){(function(g){var e=(function(){function h(i){if(typeof i==="undefined"){i=[]}this.Errors=i}return h})();g.JqueryBTFContext=e;var f=(function(h){a(i,h);function i(o,n,m){h.call(this,o,n);this.Context=m;i.Setup()}i.prototype.GetEntity=function(){var n={};var m=linq(this.Rules).Select(function(s){return linq(s.RequiredForValidation||[]).Union(s.ValidationSubjects||[]).Result}).Aggregate().Result;for(var p=0,q=m.length;p<q;p++){var o=jQuery('[name="'+m[p]+'"]',this.Context);if(o.attr("type")==="checkbox"){n[m[p]]=o.is(":checked")}else{n[m[p]]=o.val();if(o.attr("data-val-number")){if(!n[m[p]]){n[m[p]]=null}else{n[m[p]]=n[m[p]].indexOf(".")!==-1?parseFloat(n[m[p]]):parseInt(n[m[p]])}}}}return n};i.Registered=[];i.ValidatorName="backtofront";i.RegisterRule=function j(m){c.Sanitizer.Require(m,{inputName:"Rules",inputConstructor:Array},{inputName:"Entity",inputConstructor:String});i.Registered.push(new i(m.Rules,m.Entity))};i.Setup=function k(){if(!jQuery||!jQuery.validator){throw"This item requires jQuery and jQuery validation"}if(jQuery.validator.methods[i.ValidatorName]){return}jQuery.validator.addMethod(i.ValidatorName,i.Validate,function(m,n){if(this.__BTFContext&&this.__BTFContext.Errors&&this.__BTFContext.Errors.length){return linq(this.__BTFContext.Errors).Select(function(o){return o.UserMessage}).Result.join("\n");return jQuery.validator.format("These have been injected: {0}, {1}",'"me"','"and me"')}else{return undefined}});if(jQuery.validator.unobtrusive&&jQuery.validator.unobtrusive.adapters){jQuery.validator.unobtrusive.adapters.add("backtofront",[],function(m){m.rules.backtofront=m.params})}};i.Validate=function l(q,n){var o=[];for(var m=0;m<(arguments.length-2);m++){o[m]=arguments[m+2]}var p=linq(i.Registered).Select(function(r){return r.Validate($(n).attr("name"),false)}).Aggregate();this.__BTFContext=new e(p.Result);return p.Result.length===0};return i})(c.Validation.Validator);g.JQueryValidator=f})(c.Validation||(c.Validation={}));var d=c.Validation})(b||(b={}));window.__BTF=b})();